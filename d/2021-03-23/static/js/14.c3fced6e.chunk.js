(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[14],{1242:function(e,t,n){},1243:function(e,t,n){},1244:function(e,t,n){},1277:function(e,t,n){"use strict";n.r(t),n.d(t,"GatherArea",(function(){return I}));var r=n(95),a=n(4),c=n(0),i=n(1),o=n.n(i),s=(n(1242),n(14)),u=n(107),b="gatherRegionMap",j=n(533),l=n(330),d=(n(1243),o.a.memo((function(e){var t=e.roomId,n=e.userId,r=Object(i.useState)(""),o=Object(a.a)(r,2),s=o[0],j=o[1],l=Object(i.useState)("background"),d=Object(a.a)(l,2),p=d[0],O=d[1],f=Object(i.useState)(100),h=Object(a.a)(f,2),g=h[0],m=h[1],v=Object(i.useState)(100),x=Object(a.a)(v,2),y=x[0],k=x[1],I=Object(i.useState)(100),M=Object(a.a)(I,2),S=M[0],w=M[1],z=Object(i.useState)(100),C=Object(a.a)(z,2),A=C[0],N=C[1],E=Object(i.useState)(0),R=Object(a.a)(E,2),D=R[0],G=R[1],B=Object(i.useState)(""),J=Object(a.a)(B,2),L=J[0],T=J[1],P=Object(i.useState)(""),F=Object(a.a)(P,2),X=F[0],Y=F[1],q=Object(i.useState)(""),H=Object(a.a)(q,2),K=H[0],U=H[1],W=Object(i.useState)(null),_=Object(a.a)(W,2),Q=_[0],V=_[1];return Object(c.jsxs)("div",{className:"RegionEditor-container",children:[Object(c.jsx)("h3",{children:"Region Editor"}),Object(c.jsxs)("label",{children:["Region ID:"," ",Object(c.jsx)("input",{value:s,onChange:function(e){return j(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Type:"," ",Object(c.jsxs)("select",{value:p,onChange:function(e){return O(e.target.value)},children:[Object(c.jsx)("option",{value:"background",children:"Background"}),Object(c.jsx)("option",{value:"meeting",children:"Meeting"}),Object(c.jsx)("option",{value:"chat",children:"Chat"})]})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Left:"," ",Object(c.jsx)("input",{type:"number",value:g,onChange:function(e){return m(Number(e.target.value))}})]}),Object(c.jsxs)("label",{children:["Top:"," ",Object(c.jsx)("input",{type:"number",value:y,onChange:function(e){return k(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Width:"," ",Object(c.jsx)("input",{type:"number",value:S,onChange:function(e){return w(Number(e.target.value))}})]}),Object(c.jsxs)("label",{children:["Height:"," ",Object(c.jsx)("input",{type:"number",value:A,onChange:function(e){return N(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),"chat"!==p&&Object(c.jsxs)("label",{children:["zIndex:"," ",Object(c.jsx)("input",{type:"number",value:D,max:0,onChange:function(e){return G(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Background:"," ",Object(c.jsx)("input",{value:L,onChange:function(e){return T(e.target.value)}})]}),Object(c.jsxs)("label",{children:["Border:"," ",Object(c.jsx)("input",{value:X,onChange:function(e){return Y(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Iframe:"," ",Object(c.jsx)("input",{value:K,onChange:function(e){return U(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsx)("button",{type:"button",onClick:function(){return function(){var e={type:p,position:[g,y],size:[S,A],zIndex:D,background:L,border:X,iframe:K};Object(u.a)(t,n).ydoc.getMap(b).set(s,e)}()},disabled:!s,children:"Add Region"}),Object(c.jsx)("hr",{}),Object(c.jsxs)("button",{type:"button",className:"RegionEditor-toggle",onClick:function(){Q?V(null):function(){var e=Object(u.a)(t,n).ydoc.getMap(b);V(JSON.stringify(e.toJSON()))}()},children:["Import/Export ",Q?Object(c.jsx)(c.Fragment,{children:"\u25bc"}):Object(c.jsx)(c.Fragment,{children:"\u25b6"})]}),!!Q&&Object(c.jsxs)("div",{children:[Object(c.jsxs)("label",{children:["All Region Data:"," ",Object(c.jsx)("textarea",{value:Q,onChange:function(e){return V(e.target.value)}})]}),Object(c.jsx)("button",{type:"button",onClick:function(){var e=Object(u.a)(t,n).ydoc.getMap(b);try{Object.entries(JSON.parse(Q||"")).forEach((function(t){var n=Object(a.a)(t,2),r=n[0],c=n[1];e.set(r,c)})),V(null)}catch(r){console.log("failed to save all region data",r)}},children:"Replace (Be careful)"})]})]})}))),p=n(2),O=n.n(p),f=n(3),h=(n(1244),n(326)),g=o.a.memo((function(e){var t=e.roomId,n=Object(i.useState)(),r=Object(a.a)(n,2),o=r[0],s=r[1];Object(i.useEffect)((function(){Object(f.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,Object(h.a)(t);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()}),[t]);var u="remote-faces://".concat(window.location.href.replace(/^https:\/\//,""));return Object(c.jsxs)("div",{className:"LinkOpener-container",children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("span",{title:"Share this link with your colleagues",children:"Room Link: "}),Object(c.jsx)("input",{value:window.location.href,readOnly:!0})]}),Object(c.jsx)("div",{children:Object(c.jsx)("a",{href:u,title:"Open this link in the desktop app",children:"Open App"})}),Object(c.jsx)("div",{children:Object(c.jsx)("a",{href:o,target:"_blank",rel:"noreferrer",children:"Open Excalidraw"})})]})})),m=n(338),v=n(29),x=o.a.lazy((function(){return Promise.all([n.e(0),n.e(3),n.e(4)]).then(n.bind(null,1278))})),y=o.a.memo((function(e){var t=e.roomId,n=e.userId,r=e.nickname,a=e.id,o=e.data,s=e.highlight,u="meeting"===o.type&&(s?"0 0 0 5px pink":"0 0 0 1px pink")||void 0;return Object(c.jsxs)("div",{className:"GatherArea-region",style:{left:"".concat(o.position[0],"px"),top:"".concat(o.position[1],"px"),width:"".concat(o.size[0],"px"),height:"".concat(o.size[1],"px"),boxShadow:u,zIndex:"chat"!==o.type?o.zIndex:void 0,background:o.background,border:o.border},children:[o.iframe&&Object(c.jsx)("iframe",{title:a,src:o.iframe,frameBorder:"0"}),"chat"===o.type&&Object(c.jsx)(i.Suspense,{fallback:Object(c.jsx)(v.a,{}),children:Object(c.jsx)(x,{roomId:t,userId:n,nickname:r,uniqueId:a})})]})})),k=o.a.memo((function(e){var t=e.nickname,n=e.statusMesg,r=e.image,a=e.obsoleted,i=e.position,o=e.setPosition,s=e.registerOnMouseDrag,u=e.stream,b=e.muted,j=!!o;return Object(c.jsx)("div",{className:"GatherArea-avatar",style:{left:"".concat(i[0],"px"),top:"".concat(i[1],"px")},onMouseDown:function(e){if(e.preventDefault(),j){var t=e.currentTarget,n=[e.clientX-i[0],e.clientY-i[1]];s((function(e){var r=e.clientX-n[0],a=e.clientY-n[1];t.style.left="".concat(r,"px"),t.style.top="".concat(a,"px"),null===o||void 0===o||o([r,a])}))}},children:Object(c.jsx)(m.a,{image:r,nickname:t,statusMesg:n,obsoleted:!!a,liveMode:!!u,stream:u,muted:!!b,micOn:!!u,speakerOn:!!u})})})),I=o.a.memo((function(e){var t=e.roomId,n=e.userId,o=e.avatar,p=e.nickname,O=e.statusMesg,f=e.suspended,h=e.videoDeviceId,m=e.audioDeviceId,v=Object(j.a)(t,n,o,p,O,f,!1,!1,!1,h),x=v.myImage,I=v.roomImages,M=function(e,t){var n,c=Object(i.useState)({}),o=Object(a.a)(c,2),j=o[0],l=o[1],d=Object(i.useState)({position:(n=t,[parseInt(n.slice(0,2),16)/2+20,parseInt(n.slice(2,4),16)/2+20])}),p=Object(a.a)(d,2),O=p[0],f=p[1];Object(i.useEffect)((function(){var n=Object(u.a)(e,t),a=n.ydoc.getMap("gatherAvatarMap"),c=function(){l((function(e){var c=Object(r.a)({},e),i=!1;return a.forEach((function(e,r){var a,o;r!==t&&n.userIdMap[r]&&function(e){try{var t=e;return"number"===typeof t.position[0]&&"number"===typeof t.position[1]}catch(n){return!1}}(e)&&(c[r]?(a=e,o=c[r],(a.position[0]!==o.position[0]||a.position[1]!==o.position[1])&&(c[r]=e,i=!0)):(c[r]=e,i=!0))})),Object.keys(c).forEach((function(e){n.userIdMap[e]||(delete c[e],i=!0)})),i?c:e}))};a.observe(c);var i=Object(s.d)(n.userIdMap,c);return c(),function(){i(),a.unobserve(c)}}),[e,t]);var h=Object(i.useRef)();Object(i.useEffect)((function(){O&&(h.current?h.current=O:(h.current=O,setTimeout((function(){Object(u.a)(e,t).ydoc.getMap("gatherAvatarMap").set(t,h.current),h.current=void 0}),500)))}),[e,t,O]);var g=Object(i.useState)({}),m=Object(a.a)(g,2),v=m[0],x=m[1];Object(i.useEffect)((function(){var n=Object(u.a)(e,t).ydoc.getMap(b),r=function(){x((function(e){var t={};return n.forEach((function(n,r){var a,c;(function(e){try{var t=e;return!(!["background","meeting","chat"].includes(t.type)||"number"!==typeof t.position[0]||"number"!==typeof t.position[1]||"number"!==typeof t.size[0]||"number"!==typeof t.size[1]||"undefined"!==typeof t.zIndex&&"number"!==typeof t.zIndex||"undefined"!==typeof t.background&&"string"!==typeof t.background||"undefined"!==typeof t.border&&"string"!==typeof t.border||"undefined"!==typeof t.iframe&&"string"!==typeof t.iframe)}catch(n){return!1}})(n)&&(e[r]&&(c=n,(a=e[r]).type===c.type&&a.position[0]===c.position[0]&&a.position[1]===c.position[1]&&a.size[0]===c.size[0]&&a.size[1]===c.size[1]&&a.zIndex===c.zIndex&&a.background===c.background&&a.border===c.border&&a.iframe===c.iframe)?t[r]=e[r]:t[r]=n)})),t}))};return n.observe(r),r(),function(){n.unobserve(r)}}),[e,t]);var y=Object(i.useCallback)((function(n,r){Object(u.a)(e,t).ydoc.getMap(b).set(n,r)}),[e,t]);return{avatarMap:j,myAvatar:O,setMyAvatar:f,regionMap:v,updateRegion:y}}(t,n),S=M.avatarMap,w=M.myAvatar,z=M.setMyAvatar,C=M.regionMap,A=Object(i.useRef)(),N=Object(i.useCallback)((function(e){A.current=e}),[]),E=Object.keys(C).sort((function(e,t){var n,r;return(null!==(n=C[t].zIndex)&&void 0!==n?n:0)-(null!==(r=C[e].zIndex)&&void 0!==r?r:0)})).find((function(e){var t=C[e],n=t.type,r=t.position,a=t.size;return"meeting"===n&&r[0]<=w.position[0]&&r[1]<=w.position[1]&&w.position[0]+36<=r[0]+a[0]&&w.position[1]+36<=r[1]+a[1]})),R=Object(l.a)(t,n,!!E,!!E,!0,h,m,"gatherArea/meeting/".concat(E,"/")),D=R.faceStream,G=R.faceStreamMap,B=Object(i.useState)(null),J=Object(a.a)(B,2),L=J[0],T=J[1],P=Date.now()-12e4;return Object(c.jsxs)("div",{className:"GatherArea-container",children:[Object(c.jsxs)("div",{className:"GatherArea-body",onMouseMove:function(e){A.current&&A.current(e)},onMouseUp:function(){N()},children:[Object.entries(C).map((function(e){var r=Object(a.a)(e,2),i=r[0],o=r[1];return Object(c.jsx)(y,{roomId:t,userId:n,nickname:p,id:i,data:o,highlight:i===E},i)})),Object.entries(S).map((function(e){var t=Object(a.a)(e,2),r=t[0],i=t[1];if(r===n)return null;var o=I.find((function(e){return e.userId===r}));return o?Object(c.jsx)(k,{nickname:o.info.nickname,statusMesg:o.info.message,image:o.image,obsoleted:o.updated<P,position:i.position,registerOnMouseDrag:N,stream:G[r]},r):null})),Object(c.jsx)(k,{nickname:p,statusMesg:O,image:x,position:w.position,setPosition:function(e){return z((function(t){return Object(r.a)(Object(r.a)({},t),{},{position:e})}))},registerOnMouseDrag:N,stream:D||void 0,muted:!0})]}),Object(c.jsxs)("div",{className:"GatherArea-toolbar",children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("button",{type:"button",onClick:function(){return T("region-editor"===L?null:"region-editor")},children:"region-editor"===L?"Close Region Editor":"Open Region Editor"}),"region-editor"===L&&Object(c.jsx)("div",{className:"GatherArea-region-editor",children:Object(c.jsx)(d,{roomId:t,userId:n})})]}),Object(c.jsxs)("div",{children:[Object(c.jsx)("button",{type:"button",onClick:function(){return T("link-opener"===L?null:"link-opener")},children:"link-opener"===L?"Close Link Opener":"Open Link Opener"}),"link-opener"===L&&Object(c.jsx)("div",{className:"GatherArea-link-opener",children:Object(c.jsx)(g,{roomId:t})})]})]})]})}));t.default=I},326:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(2),a=n.n(r),c=n(3),i=n(26),o=n(9),s=function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,20),e.next=3,Object(o.h)(t.slice(i.a));case 3:return r=e.sent,e.next=6,window.crypto.subtle.exportKey("jwk",r);case 6:return c=e.sent.k,e.abrupt("return","https://excalidraw.com/#room=".concat(n,",").concat(c));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=14.c3fced6e.chunk.js.map