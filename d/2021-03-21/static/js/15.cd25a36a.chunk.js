(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[15],{1241:function(e,t,n){},1242:function(e,t,n){},1275:function(e,t,n){"use strict";n.r(t),n.d(t,"GatherArea",(function(){return h}));var r=n(95),a=n(4),c=n(0),i=n(1),o=n.n(i),s=(n(1241),n(14)),u=n(107),b="gatherRegionMap",j=n(532),l=n(329),d=(n(1242),o.a.memo((function(e){var t=e.roomId,n=e.userId,r=Object(i.useState)(""),o=Object(a.a)(r,2),s=o[0],j=o[1],l=Object(i.useState)("background"),d=Object(a.a)(l,2),p=d[0],O=d[1],f=Object(i.useState)(100),g=Object(a.a)(f,2),m=g[0],h=g[1],v=Object(i.useState)(100),x=Object(a.a)(v,2),y=x[0],I=x[1],k=Object(i.useState)(100),M=Object(a.a)(k,2),S=M[0],z=M[1],C=Object(i.useState)(100),A=Object(a.a)(C,2),N=A[0],E=A[1],R=Object(i.useState)(0),D=Object(a.a)(R,2),w=D[0],G=D[1],B=Object(i.useState)(""),J=Object(a.a)(B,2),T=J[0],P=J[1],F=Object(i.useState)(""),X=Object(a.a)(F,2),Y=X[0],q=X[1],H=Object(i.useState)(""),L=Object(a.a)(H,2),U=L[0],W=L[1],K=Object(i.useState)(null),Q=Object(a.a)(K,2),V=Q[0],Z=Q[1];return Object(c.jsxs)("div",{className:"RegionEditor-container",children:[Object(c.jsx)("h3",{children:"Region Editor"}),Object(c.jsxs)("label",{children:["Region ID:"," ",Object(c.jsx)("input",{value:s,onChange:function(e){return j(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Type:"," ",Object(c.jsxs)("select",{value:p,onChange:function(e){return O(e.target.value)},children:[Object(c.jsx)("option",{value:"background",children:"Background"}),Object(c.jsx)("option",{value:"meeting",children:"Meeting"}),Object(c.jsx)("option",{value:"chat",children:"Chat"})]})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Left:"," ",Object(c.jsx)("input",{type:"number",value:m,onChange:function(e){return h(Number(e.target.value))}})]}),Object(c.jsxs)("label",{children:["Top:"," ",Object(c.jsx)("input",{type:"number",value:y,onChange:function(e){return I(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Width:"," ",Object(c.jsx)("input",{type:"number",value:S,onChange:function(e){return z(Number(e.target.value))}})]}),Object(c.jsxs)("label",{children:["Height:"," ",Object(c.jsx)("input",{type:"number",value:N,onChange:function(e){return E(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),"chat"!==p&&Object(c.jsxs)("label",{children:["zIndex:"," ",Object(c.jsx)("input",{type:"number",value:w,max:0,onChange:function(e){return G(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Background:"," ",Object(c.jsx)("input",{value:T,onChange:function(e){return P(e.target.value)}})]}),Object(c.jsxs)("label",{children:["Border:"," ",Object(c.jsx)("input",{value:Y,onChange:function(e){return q(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Iframe:"," ",Object(c.jsx)("input",{value:U,onChange:function(e){return W(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsx)("button",{type:"button",onClick:function(){return function(){var e={type:p,position:[m,y],size:[S,N],zIndex:w,background:T,border:Y,iframe:U};Object(u.a)(t,n).ydoc.getMap(b).set(s,e)}()},disabled:!s,children:"Add Region"}),Object(c.jsx)("hr",{}),Object(c.jsxs)("button",{type:"button",className:"RegionEditor-toggle",onClick:function(){V?Z(null):function(){var e=Object(u.a)(t,n).ydoc.getMap(b);Z(JSON.stringify(e.toJSON()))}()},children:["Import/Export ",V?Object(c.jsx)(c.Fragment,{children:"\u25bc"}):Object(c.jsx)(c.Fragment,{children:"\u25b6"})]}),!!V&&Object(c.jsxs)("div",{children:[Object(c.jsxs)("label",{children:["All Region Data:"," ",Object(c.jsx)("textarea",{value:V,onChange:function(e){return Z(e.target.value)}})]}),Object(c.jsx)("button",{type:"button",onClick:function(){var e=Object(u.a)(t,n).ydoc.getMap(b);try{Object.entries(JSON.parse(V||"")).forEach((function(t){var n=Object(a.a)(t,2),r=n[0],c=n[1];e.set(r,c)})),Z(null)}catch(r){console.log("failed to save all region data",r)}},children:"Replace (Be careful)"})]})]})}))),p=n(337),O=n(28),f=o.a.lazy((function(){return Promise.all([n.e(0),n.e(3),n.e(4)]).then(n.bind(null,1274))})),g=o.a.memo((function(e){var t=e.roomId,n=e.userId,r=e.nickname,a=e.id,o=e.data,s=e.highlight,u="meeting"===o.type&&(s?"0 0 0 5px pink":"0 0 0 1px pink")||void 0;return Object(c.jsxs)("div",{className:"GatherArea-region",style:{left:"".concat(o.position[0],"px"),top:"".concat(o.position[1],"px"),width:"".concat(o.size[0],"px"),height:"".concat(o.size[1],"px"),boxShadow:u,zIndex:"chat"!==o.type?o.zIndex:void 0,background:o.background,border:o.border},children:[o.iframe&&Object(c.jsx)("iframe",{title:a,src:o.iframe,frameBorder:"0"}),"chat"===o.type&&Object(c.jsx)(i.Suspense,{fallback:Object(c.jsx)(O.a,{}),children:Object(c.jsx)(f,{roomId:t,userId:n,nickname:r,uniqueId:a})})]})})),m=o.a.memo((function(e){var t=e.nickname,n=e.statusMesg,r=e.image,a=e.position,i=e.setPosition,o=e.registerOnMouseDrag,s=e.stream,u=e.muted,b=!!i;return Object(c.jsx)("div",{className:"GatherArea-avatar",style:{left:"".concat(a[0],"px"),top:"".concat(a[1],"px")},onMouseDown:function(e){if(e.preventDefault(),b){var t=e.currentTarget,n=[e.clientX-a[0],e.clientY-a[1]];o((function(e){var r=e.clientX-n[0],a=e.clientY-n[1];t.style.left="".concat(r,"px"),t.style.top="".concat(a,"px"),null===i||void 0===i||i([r,a])}))}},children:Object(c.jsx)(p.a,{image:r,nickname:t,statusMesg:n,obsoleted:!1,liveMode:!!s,stream:s,muted:!!u,micOn:!!s,speakerOn:!!s})})})),h=o.a.memo((function(e){var t=e.roomId,n=e.userId,o=e.avatar,p=e.nickname,O=e.statusMesg,f=e.suspended,h=e.videoDeviceId,v=e.audioDeviceId,x=Object(j.a)(t,n,o,p,O,f,!1,!1,!1,h),y=x.myImage,I=x.roomImages,k=function(e,t){var n,c=Object(i.useState)({}),o=Object(a.a)(c,2),j=o[0],l=o[1],d=Object(i.useState)({position:(n=t,[parseInt(n.slice(0,2),16)/2+20,parseInt(n.slice(2,4),16)/2+20])}),p=Object(a.a)(d,2),O=p[0],f=p[1];Object(i.useEffect)((function(){var n=Object(u.a)(e,t),a=n.ydoc.getMap("gatherAvatarMap"),c=function(){l((function(e){var c=Object(r.a)({},e),i=!1;return a.forEach((function(e,r){var a,o;r!==t&&n.userIdMap[r]&&function(e){try{var t=e;return"number"===typeof t.position[0]&&"number"===typeof t.position[1]}catch(n){return!1}}(e)&&(c[r]?(a=e,o=c[r],(a.position[0]!==o.position[0]||a.position[1]!==o.position[1])&&(c[r]=e,i=!0)):(c[r]=e,i=!0))})),Object.keys(c).forEach((function(e){n.userIdMap[e]||(delete c[e],i=!0)})),i?c:e}))};a.observe(c);var i=Object(s.d)(n.userIdMap,c);return c(),function(){i(),a.unobserve(c)}}),[e,t]);var g=Object(i.useRef)();Object(i.useEffect)((function(){O&&(g.current?g.current=O:(g.current=O,setTimeout((function(){Object(u.a)(e,t).ydoc.getMap("gatherAvatarMap").set(t,g.current),g.current=void 0}),500)))}),[e,t,O]);var m=Object(i.useState)({}),h=Object(a.a)(m,2),v=h[0],x=h[1];Object(i.useEffect)((function(){var n=Object(u.a)(e,t).ydoc.getMap(b),r=function(){x((function(e){var t={};return n.forEach((function(n,r){var a,c;(function(e){try{var t=e;return!(!["background","meeting","chat"].includes(t.type)||"number"!==typeof t.position[0]||"number"!==typeof t.position[1]||"number"!==typeof t.size[0]||"number"!==typeof t.size[1]||"undefined"!==typeof t.zIndex&&"number"!==typeof t.zIndex||"undefined"!==typeof t.background&&"string"!==typeof t.background||"undefined"!==typeof t.border&&"string"!==typeof t.border||"undefined"!==typeof t.iframe&&"string"!==typeof t.iframe)}catch(n){return!1}})(n)&&(e[r]&&(c=n,(a=e[r]).type===c.type&&a.position[0]===c.position[0]&&a.position[1]===c.position[1]&&a.size[0]===c.size[0]&&a.size[1]===c.size[1]&&a.zIndex===c.zIndex&&a.background===c.background&&a.border===c.border&&a.iframe===c.iframe)?t[r]=e[r]:t[r]=n)})),t}))};return n.observe(r),r(),function(){n.unobserve(r)}}),[e,t]);var y=Object(i.useCallback)((function(n,r){Object(u.a)(e,t).ydoc.getMap(b).set(n,r)}),[e,t]);return{avatarMap:j,myAvatar:O,setMyAvatar:f,regionMap:v,updateRegion:y}}(t,n),M=k.avatarMap,S=k.myAvatar,z=k.setMyAvatar,C=k.regionMap,A=Object(i.useRef)(),N=Object(i.useCallback)((function(e){A.current=e}),[]),E=Object.keys(C).sort((function(e,t){var n,r;return(null!==(n=C[t].zIndex)&&void 0!==n?n:0)-(null!==(r=C[e].zIndex)&&void 0!==r?r:0)})).find((function(e){var t=C[e],n=t.type,r=t.position,a=t.size;return"meeting"===n&&r[0]<=S.position[0]&&r[1]<=S.position[1]&&S.position[0]+36<=r[0]+a[0]&&S.position[1]+36<=r[1]+a[1]})),R=Object(l.a)(t,n,!!E,!!E,!0,h,v,"gatherArea/meeting/".concat(E,"/")),D=R.faceStream,w=R.faceStreamMap,G=Object(i.useState)(!1),B=Object(a.a)(G,2),J=B[0],T=B[1];return Object(c.jsxs)("div",{className:"GatherArea-container",children:[Object(c.jsxs)("div",{className:"GatherArea-body",onMouseMove:function(e){A.current&&A.current(e)},onMouseUp:function(){N()},children:[Object.entries(C).map((function(e){var r=Object(a.a)(e,2),i=r[0],o=r[1];return Object(c.jsx)(g,{roomId:t,userId:n,nickname:p,id:i,data:o,highlight:i===E},i)})),Object.entries(M).map((function(e){var t=Object(a.a)(e,2),r=t[0],i=t[1];if(r===n)return null;var o=I.find((function(e){return e.userId===r}));return o?Object(c.jsx)(m,{nickname:o.info.nickname,statusMesg:o.info.message,image:o.image,position:i.position,registerOnMouseDrag:N,stream:w[r]},r):null})),Object(c.jsx)(m,{nickname:p,statusMesg:O,image:y,position:S.position,setPosition:function(e){return z((function(t){return Object(r.a)(Object(r.a)({},t),{},{position:e})}))},registerOnMouseDrag:N,stream:D||void 0,muted:!0})]}),Object(c.jsx)("div",{className:"GatherArea-toolbar",children:Object(c.jsxs)("div",{children:[Object(c.jsx)("button",{type:"button",onClick:function(){return T((function(e){return!e}))},children:J?"Close Region Editor":"Open Region Editor"}),J&&Object(c.jsx)("div",{className:"GatherArea-region-editor",children:Object(c.jsx)(d,{roomId:t,userId:n})})]})})]})}));t.default=h}}]);
//# sourceMappingURL=15.cd25a36a.chunk.js.map