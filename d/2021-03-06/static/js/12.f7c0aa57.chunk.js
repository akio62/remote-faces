(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[12],{1234:function(e,t,n){},1237:function(e,t,n){},1255:function(e,t,n){"use strict";n.r(t),n.d(t,"MomentaryChat",(function(){return E}));var a=n(4),c=n(0),r=n(1),i=n.n(r),o=n(1233),s=n.n(o),u=(n(1234),n(107)),l=n(13),b=n(9),f=n(105),d=n(120),j=function(e){return Array.isArray(e)&&2===e.length&&"string"===typeof e[0]&&"number"===typeof e[1]},m=function(e){return Object(f.c)(e)&&"string"===typeof e.nickname&&"string"===typeof e.messageId&&"number"===typeof e.createdAt&&"string"===typeof e.text&&("undefined"===typeof e.inReplyTo||"string"===typeof e.inReplyTo)&&("undefined"===typeof e.replies||function(e){return Array.isArray(e)&&e.every(j)}(e.replies))},h=function(e,t){var n=t[1]-e[1];return 0===n?e[0].length-t[0].length:n},O=function(e,t,n){var c=Object(r.useState)([]),i=Object(a.a)(c,2),o=i[0],s=i[1],j=Object(r.useRef)(o);Object(r.useEffect)((function(){j.current=o}));var O=Object(r.useCallback)((function(e){if(e.inReplyTo){var t=e.text,n=e.inReplyTo;s((function(e){return e.map((function(e){if(e.messageId===n){var a=new Map(e.replies);a.set(t,(a.get(t)||0)+1);var c=Object(l.a)(a.entries());return c.sort(h),Object(u.a)(Object(u.a)({},e),{},{replies:c})}return e}))}))}else s((function(t){if(t.some((function(t){return t.messageId===e.messageId})))return t;var n=[e].concat(Object(l.a)(t));return n.length>100&&n.pop(),n.sort((function(e,t){return t.createdAt-e.createdAt})),n}))}),[]);Object(d.e)(e,t,Object(r.useCallback)((function(e){j.current.forEach((function(t){e({chat:t})}))}),[]));var p=Object(d.a)(e,t);Object(d.b)(e,t,Object(r.useCallback)((function(e){var t;t=e,Object(f.c)(t)&&m(t.chat)&&O(e.chat)}),[O]));var y=Object(r.useCallback)((function(e){var t={nickname:n,messageId:Object(b.j)(),createdAt:Date.now(),text:e};p({chat:t}),O(t)}),[p,n,O]),g=Object(r.useCallback)((function(e,t){var a={nickname:n,messageId:Object(b.j)(),createdAt:Date.now(),text:e,inReplyTo:t};p({chat:a}),O(a)}),[p,n,O]);return{chatList:o,sendChat:y,replyChat:g}},p=n(322),y=n(1235),g=n(1236),C=n.n(g),v=(n(1237),{toolbar:["specialCharacters","|","bold","italic","link","blockQuote","|","imageUpload","insertTable","mediaEmbed","|","undo","redo"],balloonToolbar:["heading","|","bulletedList","numberedList","indent","outdent"],link:{addTargetToExternalLinks:!0}}),x=i.a.memo((function(e){var t=e.registerClear,n=e.onChange,a=e.onMetaEnter;return Object(c.jsx)(y.CKEditor,{editor:C.a,config:v,onReady:function(e){e.sourceElement.addEventListener("keydown",(function(e){e.metaKey&&"Enter"===e.code&&a()})),t((function(){e.setData("")})),function(e){e.plugins.get("SpecialCharacters").addItems("Emoji",[{title:"smiley face",character:"\ud83d\ude0a"},{title:"rocket",character:"\ud83d\ude80"},{title:"wind blowing face",character:"\ud83c\udf2c\ufe0f"},{title:"floppy disk",character:"\ud83d\udcbe"},{title:"heart",character:"\u2764\ufe0f"}])}(e)},onChange:function(e,t){var a=t.getData();n(a)}})})),k=1048576,N=function(e){return new Date(e.createdAt).toLocaleString().split(" ")[1].slice(0,-3)},M=i.a.memo((function(e){var t,n=e.item,i=e.replyChat,o=Object(r.useState)(!1),u=Object(a.a)(o,2),l=u[0],b=u[1],f=function(e){return i(e,n.messageId)};return Object(c.jsxs)("li",{className:"MomentaryChat-listPart",children:[l&&Object(c.jsx)(p.b,{onSelect:function(e){f(e.native),b(!1)},style:{width:"100%"}}),Object(c.jsxs)("div",{className:"MomentaryChat-listPart-header",children:[Object(c.jsx)("div",{className:"MomentaryChat-iconButton-container",children:Object(c.jsx)("div",{className:"MomentaryChat-iconButton",children:Object(c.jsx)("button",{type:"button",onClick:function(){b(!l)},children:"+"})})}),Object(c.jsx)("span",{className:"MomentaryChat-nickname",children:n.nickname||"No Name"}),Object(c.jsx)("span",{className:"MomentaryChat-time",children:N(n)})]}),Object(c.jsx)("div",{className:"MomentaryChat-text ck-content",dangerouslySetInnerHTML:(t=n.text,{__html:s.a.sanitize(t,{ADD_ATTR:["target"]})})}),(n.replies||[]).map((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(c.jsxs)("button",{className:"MomentaryChat-icon",type:"button",onClick:function(){return f(n)},children:[n," ",r]},n)}))]},n.messageId)})),w=i.a.memo((function(e){var t,n=e.chatList,a=e.replyChat,i=Object(r.useRef)(null),o=null===(t=n[0])||void 0===t?void 0:t.messageId;return Object(r.useEffect)((function(){i.current&&o&&(i.current.scrollTop=i.current.scrollHeight)}),[o]),Object(c.jsx)("ul",{className:"MomentaryChat-list",ref:i,children:n.map((function(e){return Object(c.jsx)(M,{item:e,replyChat:a},e.messageId)}))})})),E=i.a.memo((function(e){var t=e.roomId,n=e.userId,i=e.nickname,o=Object(r.useRef)(null),s=O(t,n,i),u=s.chatList,l=s.sendChat,b=s.replyChat,f=Object(r.useRef)(),d=Object(r.useState)(!1),j=Object(a.a)(d,2),m=j[0],h=j[1],p=Object(r.useRef)(""),y=Object(r.useCallback)((function(e){p.current=e,h(!!e&&e.length<=k)}),[]),g=Object(r.useCallback)((function(){p.current&&p.current.length<=k&&(l(p.current),y(""),f.current&&f.current())}),[l,y]),C=function(){var e=Object(r.useRef)(),t=Object(r.useCallback)((function(t){"granted"===Notification.permission&&(e.current&&e.current.close(),e.current=new Notification(t))}),[]);return Object(r.useEffect)((function(){"granted"!==Notification.permission&&Notification.requestPermission()}),[]),t}(),v=u[0];return Object(r.useEffect)((function(){v&&v.createdAt>Date.now()-1e4&&new RegExp("@".concat(i,"\\b")).test(v.text)&&C("You got a new message!")}),[i,v,C]),Object(c.jsxs)("div",{className:"MomentaryChat-container",ref:o,children:[Object(c.jsx)(w,{chatList:u,replyChat:b}),Object(c.jsx)("div",{className:"MomentaryChat-editor",children:Object(c.jsx)(x,{registerClear:function(e){f.current=e},onChange:y,onMetaEnter:g})}),Object(c.jsx)("div",{className:"MomentaryChat-button",children:Object(c.jsx)("button",{type:"button",onClick:g,disabled:!m,children:"Send"})})]})}));t.default=E},322:function(e,t,n){"use strict";n.d(t,"b",(function(){return c}));n(517);var a=n(172);n.d(t,"a",(function(){return a.a}));var c=a.b}}]);
//# sourceMappingURL=12.f7c0aa57.chunk.js.map