{"version":3,"sources":["utils/storage.ts","states/singleRoom.ts","utils/crypto.ts","utils/url.ts","media/devices.ts","hooks/useAvailableDevices.ts","network/common.ts","network/room.ts","components/SuspenseFallback.tsx","media/imagePresets.ts","components/ErrorFallback.tsx","components/SingleRoomEntrance.tsx","components/GitHubCorner.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["setStringItem","name","value","window","localStorage","setItem","e","console","info","getStringItem","getItem","initialAvatar","NEUTRAL_FACE","initialNickname","initialTakePhoto","initialVideoDeviceId","initialAudioDeviceId","singleRoomState","proxy","roomId","getRoomIdFromUrl","roomEntered","userId","secureRandomId","config","avatar","nickname","takePhoto","videoDeviceId","audioDeviceId","setConfig","toggleConfigTakePhoto","sha256","text","a","encoder","TextEncoder","data","encode","crypto","subtle","digest","buf","arr","Array","from","Uint8Array","hex","map","b","toString","padStart","join","len","getRandomValues","rand4","Uint16Array","generateCryptoKey","generateKey","length","key","exportKey","importCryptoKey","usages","size","i","parseInt","slice","importKey","cryptoKey","encryptBuffer","input","iv","encrypt","encrypted","output","byteLength","set","buffer","decryptBuffer","byteOffset","decrypt","decrypted","encryptString","encoded","compressed","pako","deflate","decryptString","decompressed","inflate","decoder","TextDecoder","decode","encryptStringToChunks","chunkSize","chunkData","deflator","Deflate","onData","d","push","id","chunk","of","chunkStore","decryptStringFromChunks","Uint32Array","index","store","find","item","chunks","shift","Error","inflator","Inflate","result","encryptBufferFromChunks","bufferList","totalLength","reduce","accum","concatenated","forEach","decryptBufferToChunks","lengthList","hash","location","URLSearchParams","get","setRoomIdToUrl","searchParams","hasPeerJsConfigInUrl","has","getPeerJsConfigFromUrl","server","url","URL","secure","protocol","defaultPort","host","split","port","Number","path","pathname","hasPubsubConfigInUrl","getVideoDeviceInfoList","navigator","mediaDevices","getUserMedia","video","enumerateDevices","devices","list","filter","kind","label","deviceId","getAudioDeviceInfoList","audio","useVideoDevices","useState","setDevices","useEffect","deviceInfoList","useAudioDevices","ROOM_ID_PREFIX_LEN","createRoom","createRoomImpl","SuspenseFallback","React","memo","className","BLANK_IMAGE","ErrorFallback","err","waitSec","setWaitSec","setTimeout","reload","message","Landing","lazy","SingleRoom","SingleRoomEntrance","useSnapshot","setName","setTakePhoto","setAvatar","videoDevices","audioDevices","setVideoDeviceId","setAudioDeviceId","entering","setEntering","onEnter","src","alt","type","accept","onChange","files","file","alert","reader","FileReader","onload","readAsDataURL","onChangeAvatar","target","checked","placeholder","videoDevice","audioDevice","onClick","disabled","GitHubCorner","fill","color","href","aria-label","rel","width","height","viewBox","style","position","top","border","right","aria-hidden","transformOrigin","ErrorBoundary","state","children","this","props","PureComponent","App","fallback","Boolean","hostname","match","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","then","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.15cc3cbf.chunk.js","sourcesContent":["type StringItemName =\n  | \"nickname\"\n  | \"avatar_img\"\n  | \"take_photo\"\n  | \"config_hidden\"\n  | \"faceimage_video_device_id\"\n  | \"faceimage_audio_device_id\";\n\ntype JsonItemName = \"TODO2\" | \"TODO3\";\n\nexport const setStringItem = (name: StringItemName, value: string) => {\n  try {\n    window.localStorage.setItem(name, value);\n  } catch (e) {\n    console.info(\"Failed to save string to localStorage\", e);\n  }\n};\n\nexport const getStringItem = (name: StringItemName) => {\n  try {\n    return window.localStorage.getItem(name) || \"\";\n  } catch (e) {\n    // ignore\n    return \"\";\n  }\n};\n\nexport const setJsonItem = (name: JsonItemName, value: unknown) => {\n  try {\n    window.localStorage.setItem(name, JSON.stringify(value));\n  } catch (e) {\n    console.info(\"Failed to save json to localStorage\", e);\n  }\n};\n\nexport const getJsonItem = (name: JsonItemName): unknown | null => {\n  try {\n    return JSON.parse(window.localStorage.getItem(name) || \"\");\n  } catch (e) {\n    // ignore\n    return null;\n  }\n};\n\nexport const removeItem = (name: StringItemName | JsonItemName) => {\n  try {\n    window.localStorage.removeItem(name);\n  } catch (e) {\n    // ignore\n  }\n};\n","import { proxy } from \"valtio\";\n\nimport { secureRandomId } from \"../utils/crypto\";\nimport { getRoomIdFromUrl } from \"../utils/url\";\nimport { NEUTRAL_FACE } from \"../media/imagePresets\";\nimport { getStringItem, setStringItem } from \"../utils/storage\";\n\nconst initialAvatar = getStringItem(\"avatar_img\") || NEUTRAL_FACE;\nconst initialNickname = getStringItem(\"nickname\");\nconst initialTakePhoto = getStringItem(\"take_photo\");\nconst initialVideoDeviceId = getStringItem(\"faceimage_video_device_id\");\nconst initialAudioDeviceId = getStringItem(\"faceimage_audio_device_id\");\n\ntype SingleRoomState = {\n  roomId: string;\n  roomEntered: boolean;\n  userId: string;\n  config: {\n    avatar: string;\n    nickname: string;\n    takePhoto: boolean;\n    videoDeviceId: string;\n    audioDeviceId: string;\n  };\n};\n\nexport const singleRoomState = proxy<SingleRoomState>({\n  roomId: getRoomIdFromUrl() || \"\",\n  roomEntered: false,\n  userId: secureRandomId(),\n  config: {\n    avatar: initialAvatar,\n    nickname: initialNickname,\n    takePhoto: !!initialTakePhoto,\n    videoDeviceId: initialVideoDeviceId,\n    audioDeviceId: initialAudioDeviceId,\n  },\n});\n\nexport const setConfig = (\n  avatar: string,\n  nickname: string,\n  takePhoto: boolean,\n  videoDeviceId: string,\n  audioDeviceId: string\n) => {\n  singleRoomState.config = {\n    avatar,\n    nickname,\n    takePhoto,\n    videoDeviceId,\n    audioDeviceId,\n  };\n  setStringItem(\"avatar_img\", avatar);\n  setStringItem(\"nickname\", nickname);\n  setStringItem(\"take_photo\", takePhoto ? \"yes\" : \"\");\n  setStringItem(\"faceimage_video_device_id\", videoDeviceId);\n  setStringItem(\"faceimage_video_device_id\", videoDeviceId);\n};\n\nexport const toggleConfigTakePhoto = () => {\n  const takePhoto = !singleRoomState.config.takePhoto;\n  singleRoomState.config.takePhoto = takePhoto;\n  setStringItem(\"take_photo\", takePhoto ? \"yes\" : \"\");\n};\n","import pako from \"pako\";\n\nexport const sha256 = async (text: string) => {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(text);\n  const buf = await window.crypto.subtle.digest(\"SHA-256\", data);\n  const arr = Array.from(new Uint8Array(buf));\n  const hex = arr.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n  return hex;\n};\n\nexport const secureRandomId = (len = 32) => {\n  const buf = window.crypto.getRandomValues(new Uint8Array(len));\n  const arr = Array.from(buf);\n  const hex = arr.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n  return hex;\n};\n\nexport const rand4 = () => {\n  const rand = window.crypto.getRandomValues(new Uint16Array(1))[0];\n  return 1000 + (rand % 9000);\n};\n\nexport const generateCryptoKey = async () => {\n  const key = await window.crypto.subtle.generateKey(\n    { name: \"AES-GCM\", length: 128 },\n    true,\n    [\"encrypt\", \"decrypt\"]\n  );\n  const buf = await window.crypto.subtle.exportKey(\"raw\", key);\n  const arr = Array.from(new Uint8Array(buf));\n  const hex = arr.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n  return hex;\n};\n\nexport const importCryptoKey = async (\n  key: string,\n  usages: (\"encrypt\" | \"decrypt\")[] = [\"encrypt\", \"decrypt\"]\n) => {\n  const size = key.length / 2;\n  const buf = new Uint8Array(size);\n  for (let i = 0; i < size; i += 1) {\n    buf[i] = parseInt(key.slice(i * 2, i * 2 + 2), 16);\n  }\n  const cryptoKey = await window.crypto.subtle.importKey(\n    \"raw\",\n    buf,\n    { name: \"AES-GCM\", length: 128 },\n    true,\n    usages\n  );\n  return cryptoKey;\n};\n\nexport const encryptBuffer = async (\n  input: ArrayBuffer,\n  key: CryptoKey\n): Promise<ArrayBuffer> => {\n  const iv = window.crypto.getRandomValues(new Uint8Array(12));\n  const encrypted = await window.crypto.subtle.encrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    input\n  );\n  const output = new Uint8Array(iv.length + encrypted.byteLength);\n  output.set(iv);\n  output.set(new Uint8Array(encrypted), iv.length);\n  return output.buffer;\n};\n\nexport const decryptBuffer = async (\n  input: ArrayBuffer,\n  byteOffset: number,\n  byteLength: number,\n  key: CryptoKey\n): Promise<ArrayBuffer> => {\n  const decrypted = await window.crypto.subtle.decrypt(\n    { name: \"AES-GCM\", iv: input.slice(byteOffset, byteOffset + 12) },\n    key,\n    input.slice(byteOffset + 12, byteOffset + byteLength)\n  );\n  return decrypted;\n};\n\n// encrypt with compression\nexport const encryptString = async (data: string, cryptoKey: CryptoKey) => {\n  const encoder = new TextEncoder();\n  const encoded = encoder.encode(data);\n  const compressed = pako.deflate(encoded);\n  return encryptBuffer(compressed, cryptoKey);\n};\n\n// decrypt with decompression\nexport const decryptString = async (buf: ArrayBuffer, cryptoKey: CryptoKey) => {\n  const decrypted = await decryptBuffer(buf, 0, buf.byteLength, cryptoKey);\n  const decompressed = pako.inflate(new Uint8Array(decrypted));\n  const decoder = new TextDecoder(\"utf-8\");\n  const data = decoder.decode(decompressed);\n  return data;\n};\n\n// encrypt into chunks\nexport async function* encryptStringToChunks(\n  data: string,\n  cryptoKey: CryptoKey,\n  chunkSize = 60000\n) {\n  const encoder = new TextEncoder();\n  const encoded = encoder.encode(data);\n  const chunkData: Uint8Array[] = [];\n  const deflator = new pako.Deflate({ chunkSize });\n  deflator.onData = (d: Uint8Array) => {\n    chunkData.push(d);\n  };\n  deflator.push(encoded, true);\n  const len = chunkData.length;\n  const id = window.crypto.getRandomValues(new Uint8Array(4));\n  for (let i = 0; i < len; i += 1) {\n    const chunk = new Uint8Array(4 + 2 + 2 + chunkData[i].byteLength);\n    chunk.set(id);\n    chunk.set(new Uint8Array(Uint16Array.of(i).buffer), 4);\n    chunk.set(new Uint8Array(Uint16Array.of(len).buffer), 4 + 2);\n    chunk.set(chunkData[i], 4 + 2 + 2);\n    yield encryptBuffer(chunk, cryptoKey);\n  }\n}\n\nconst chunkStore: {\n  id: number;\n  len: number;\n  chunks: ArrayBuffer[];\n}[] = [];\n\nconst MAX_CHUNK_STORE_SIZE = 100;\n\n// decrypt from chunks\nexport const decryptStringFromChunks = async (\n  buf: ArrayBuffer,\n  cryptoKey: CryptoKey\n) => {\n  const chunk = await decryptBuffer(buf, 0, buf.byteLength, cryptoKey);\n  const id = new Uint32Array(chunk, 0, 4)[0];\n  const index = new Uint16Array(chunk, 4, 2)[0];\n  const len = new Uint16Array(chunk, 4 + 2, 2)[0];\n  let store = chunkStore.find((item) => item.id === id);\n  if (!store) {\n    store = { id, len, chunks: [] };\n    chunkStore.push(store);\n    if (chunkStore.length > MAX_CHUNK_STORE_SIZE) {\n      chunkStore.shift();\n    }\n  } else if (store.len !== len) {\n    throw new Error(\"chunk len mismatch\");\n  }\n  store.chunks[index] = chunk;\n  for (let i = 0; i < len; i += 1) {\n    if (!store.chunks[i]) {\n      // not all chunks are ready\n      return null;\n    }\n  }\n  const inflator = new pako.Inflate();\n  for (let i = 0; i < len; i += 1) {\n    inflator.push(new Uint8Array(store.chunks[i], 4 + 2 + 2), i === len - 1);\n  }\n  const decoder = new TextDecoder(\"utf-8\");\n  const data = decoder.decode(inflator.result as Uint8Array);\n  return data;\n};\n\n// encrypt from buffer chunks\nexport const encryptBufferFromChunks = (\n  bufferList: ArrayBuffer[],\n  cryptoKey: CryptoKey\n) => {\n  const totalLength =\n    (bufferList.length + 1) * 2 +\n    bufferList.reduce((accum, buffer) => accum + buffer.byteLength, 0);\n  const concatenated = new Uint8Array(totalLength);\n  let index = 0;\n  bufferList.forEach((buffer) => {\n    if (buffer.byteLength === 0) throw new Error(\"buffer is empty\");\n    concatenated.set(\n      new Uint8Array(Uint16Array.of(buffer.byteLength).buffer),\n      index\n    );\n    index += 2;\n  });\n  concatenated.set(new Uint8Array(Uint16Array.of(0).buffer), index);\n  index += 2;\n  bufferList.forEach((buffer) => {\n    concatenated.set(new Uint8Array(buffer), index);\n    index += buffer.byteLength;\n  });\n  return encryptBuffer(concatenated, cryptoKey);\n};\n\n// decrypt to buffer chunks\nexport const decryptBufferToChunks = async (\n  input: ArrayBuffer,\n  byteOffset: number,\n  byteLength: number,\n  cryptoKey: CryptoKey\n) => {\n  const decrypted = await decryptBuffer(\n    input,\n    byteOffset,\n    byteLength,\n    cryptoKey\n  );\n  const lengthList: number[] = [];\n  let index = 0;\n  while (index < decrypted.byteLength) {\n    const len = new Uint16Array(decrypted, index, 2)[0];\n    index += 2;\n    if (len === 0) break;\n    lengthList.push(len);\n  }\n  const bufferList: ArrayBuffer[] = [];\n  lengthList.forEach((len) => {\n    bufferList.push(decrypted.slice(index, index + len));\n    index += len;\n  });\n  return bufferList;\n};\n","export const copyHashFromLink = (link: string) => {\n  try {\n    const srcHash = new URL(link).hash.slice(1);\n    const srcSearchParams = new URLSearchParams(srcHash);\n    const dstHash = window.location.hash.slice(1);\n    const dstSearchParams = new URLSearchParams(dstHash);\n    srcSearchParams.forEach((value, key) => {\n      dstSearchParams.set(key, value);\n    });\n    window.location.hash = dstSearchParams.toString();\n  } catch (e) {\n    // ignore\n  }\n};\n\nexport const extractRoomIdFromLink = (link: string) => {\n  try {\n    const hash = new URL(link).hash.slice(1);\n    const searchParams = new URLSearchParams(hash);\n    return searchParams.get(\"roomId\");\n  } catch (e) {\n    return null;\n  }\n};\n\nexport const getRoomIdFromUrl = () => {\n  const hash = window.location.hash.slice(1);\n  const searchParams = new URLSearchParams(hash);\n  return searchParams.get(\"roomId\");\n};\n\nexport const setRoomIdToUrl = (roomId: string) => {\n  const hash = window.location.hash.slice(1);\n  const searchParams = new URLSearchParams(hash);\n  searchParams.set(\"roomId\", roomId);\n  window.location.hash = searchParams.toString();\n};\n\nexport const hasPeerJsConfigInUrl = () => {\n  const hash = window.location.hash.slice(1);\n  const searchParams = new URLSearchParams(hash);\n  return searchParams.has(\"peerjs\");\n};\n\nexport const getPeerJsConfigFromUrl = () => {\n  const hash = window.location.hash.slice(1);\n  const searchParams = new URLSearchParams(hash);\n  const server = searchParams.get(\"peerjs\");\n  try {\n    const url = new URL(server || \"\");\n    const secure = url.protocol === \"https:\";\n    const defaultPort = secure ? 443 : 80;\n    return {\n      host: url.host.split(\":\")[0],\n      port: url.port ? Number(url.port) : defaultPort,\n      path: url.pathname,\n      secure,\n    };\n  } catch (e) {\n    // ignore\n  }\n  return undefined;\n};\n\nexport const hasPubsubConfigInUrl = () => {\n  const hash = window.location.hash.slice(1);\n  const searchParams = new URLSearchParams(hash);\n  return searchParams.has(\"pubsub\");\n};\n","type DeviceInfo = {\n  label: string;\n  deviceId: string;\n};\n\nexport const getVideoDeviceInfoList = async () => {\n  try {\n    await navigator.mediaDevices.getUserMedia({ video: true });\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const list: DeviceInfo[] = devices\n      .filter(({ kind }) => kind === \"videoinput\")\n      .map(({ label, deviceId }) => ({ label, deviceId }));\n    return list;\n  } catch (e) {\n    // ignored\n    return [];\n  }\n};\n\nexport const getAudioDeviceInfoList = async () => {\n  try {\n    await navigator.mediaDevices.getUserMedia({ audio: true });\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const list: DeviceInfo[] = devices\n      .filter(({ kind }) => kind === \"audioinput\")\n      .map(({ label, deviceId }) => ({ label, deviceId }));\n    return list;\n  } catch (e) {\n    // ignored\n    return [];\n  }\n};\n","import { useEffect, useState } from \"react\";\n\nimport {\n  getVideoDeviceInfoList,\n  getAudioDeviceInfoList,\n} from \"../media/devices\";\n\ntype VideoDeviceInfoList = ReturnType<\n  typeof getVideoDeviceInfoList\n> extends Promise<infer T>\n  ? T\n  : never;\n\nexport const useVideoDevices = () => {\n  const [devices, setDevices] = useState<VideoDeviceInfoList>([]);\n  useEffect(() => {\n    (async () => {\n      const deviceInfoList = await getVideoDeviceInfoList();\n      setDevices(deviceInfoList);\n    })();\n  }, []);\n  return devices;\n};\n\ntype AudioDeviceInfoList = ReturnType<\n  typeof getAudioDeviceInfoList\n> extends Promise<infer T>\n  ? T\n  : never;\n\nexport const useAudioDevices = () => {\n  const [devices, setDevices] = useState<AudioDeviceInfoList>([]);\n  useEffect(() => {\n    (async () => {\n      const deviceInfoList = await getAudioDeviceInfoList();\n      setDevices(deviceInfoList);\n    })();\n  }, []);\n  return devices;\n};\n","export const ROOM_ID_PREFIX_LEN = 32;\n\nexport type NetworkStatus =\n  | { type: \"CONNECTING_SEED_PEERS\" }\n  | { type: \"NEW_CONNECTION\"; peerIndex: number }\n  | { type: \"CONNECTION_CLOSED\"; peerIndex: number }\n  | { type: \"INITIALIZING_PEER\"; peerIndex: number }\n  | { type: \"RECONNECTING\" }\n  | { type: \"SERVER_ERROR\" }\n  | { type: \"UNKNOWN_ERROR\"; err: Error }\n  | { type: \"CONNECTED_PEERS\"; peerIndexList: number[] };\n\ntype UpdateNetworkStatus = (status: NetworkStatus) => void;\n\nexport type PeerInfo = {\n  userId: string;\n  peerIndex: number;\n  mediaTypes: string[];\n};\ntype NotifyNewPeer = (peerIndex: number) => void;\ntype ReceiveData = (data: unknown, info: PeerInfo) => void;\ntype ReceiveTrack = (\n  mediaType: string,\n  track: MediaStreamTrack,\n  info: PeerInfo\n) => void;\n\nexport type CreateRoom = (\n  roomId: string,\n  userId: string,\n  updateNetworkStatus: UpdateNetworkStatus,\n  notifyNewPeer: NotifyNewPeer,\n  receiveData: ReceiveData,\n  receiveTrack: ReceiveTrack\n) => Promise<{\n  broadcastData: (data: unknown) => void;\n  sendData: (data: unknown, peerIndex: number) => void;\n  acceptMediaTypes: (mediaTypes: string[]) => void;\n  addTrack: (mediaType: string, track: MediaStreamTrack) => void;\n  removeTrack: (mediaType: string) => void;\n  dispose: () => void;\n}>;\n","import { hasPeerJsConfigInUrl, hasPubsubConfigInUrl } from \"../utils/url\";\nimport type { CreateRoom } from \"./common\";\n\nexport type { NetworkStatus, PeerInfo } from \"./common\";\nexport { ROOM_ID_PREFIX_LEN } from \"./common\";\n\nexport const createRoom: CreateRoom = async (...args) => {\n  let createRoomImpl: CreateRoom;\n  if (hasPeerJsConfigInUrl()) {\n    createRoomImpl = (await import(\"./peerjsRoom\")).createRoom;\n  } else if (hasPubsubConfigInUrl()) {\n    createRoomImpl = (await import(\"./pubsubRoom\")).createRoom;\n  } else {\n    createRoomImpl = (await import(\"./ipfsRoom\")).createRoom;\n  }\n  return createRoomImpl(...args);\n};\n","import React from \"react\";\n\nimport \"./SuspenseFallback.css\";\n\nexport const SuspenseFallback = React.memo(() => (\n  <div className=\"SuspenseFallback-container\">\n    <div>Loading...</div>\n  </div>\n));\n","export const BLANK_IMAGE =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12NgYAAAAAMAASDVlMcAAAAASUVORK5CYII=\";\n\nexport const NEUTRAL_FACE =\n  \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBYRXhpZgAATU0AKgAAAAgAAgESAAMAAAABAAEAAIdpAAQAAAABAAAAJgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAASKADAAQAAAABAAAASAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/8AAEQgASABIAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMAAwICAgICAwICAgMDAwMEBgQEBAQECAYGBQYJCAoKCQgJCQoMDwwKCw4LCQkNEQ0ODxAQERAKDBITEhATDxAQEP/bAEMBAwMDBAMECAQECBALCQsQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEP/dAAQABf/aAAwDAQACEQMRAD8A+q6KKKACiiigAooooAKKKKACiiigD//Q+q6KKKACms6oMs2M8fWkmlSCJ5pOFQEmuv8AANloen2L+K/EskIKoZlM5Ajt4hzk574718zxJxNQ4ehCMrOpP4U9Fpu35K621b+9ehgsBLFRlVfwx373eyX9aHNpperSxefFpN48fXcIjjFVd43tGcq69VYYI/Cve9P8UaZqOnQ6lpt3b3FlPH5kU8TAxunqD6Vw3ihvCXjrSZNW8P39nNcQu6R3dqwYeYvVGx1r5VeIMcO1OrKM49Uk4tel5ST9Ha/c6oZdGvLkinF9G3dfPRf10PP6KgtLj7RFuZdroxRx6MOtT1+l0K9PFUo16TvGSTT7p6o8mrSnRm6dRWadmFFFFamZ/9H6rooooAyPFUzQaHcSL2xu+mea0dTtLbxd4IvvDN7qH2W31K1MBlDAbcj36/Sm39nFf2U1lKPkmQofxrgpYNPurc+DvGlsZYoZA0RLlBKB91gR/Kvw7xay3EPEYfMo39mlytpX5Xe6fz/Q+/4RnTxGGqYP7d+Zeatb8LfiereC9P0vwh4Cs/A0GtRTQWtq9uZTMoJ3ZyRzx14rm/h14Q0/4Y+GLrQNL1n7cs10908hYfLu6DA6cd+9covw0+Fhjz/Y75x/z9P/AI1FFa+G/CAuLHwfp7LdahhTGJGctjoeTwBmvx/kVXmp0Kkpym07cu7+923PpqOWypzcqist2dT4eujdXWqODlBc8fXHP9K2qy/DmlNpGmJbyvvnkYyzN6uev+H4VqV/WvDWBq5blGHwlf44wSfr2+Wx+W5ziKeLx9WtS+Ft2/z+YUUUV7h5h//S+q6KKKACqWp6Rp+rw+Tf2yyDsT1H0NXaKzrUaeIg6dWKlF7p6ounUnRkp02011Ryx8A2GcJqN8sf9wSmtbSfDmlaNlrO3/eMPmkc7mP4mtOivKwfDuVZfV9vhsPGMu6Wv/AO/EZxj8XT9lWqyce1wooor2TzQooooA//0/quiiigAooooAKKKKACiiigAooooA//2Q==\";\n","import React, { useEffect, useState } from \"react\";\n\nexport const ErrorFallback = React.memo<{\n  err: Error;\n}>(({ err }) => {\n  const [waitSec, setWaitSec] = useState(30);\n\n  useEffect(() => {\n    if (waitSec > 0) {\n      setTimeout(() => {\n        setWaitSec(waitSec - 1);\n      }, 1000);\n    } else {\n      window.location.reload();\n    }\n  });\n\n  return (\n    <div>\n      <h1>Unrecoverable error occurred.</h1>\n      {err && (\n        <h6>\n          {err.name}: {err.message}\n        </h6>\n      )}\n      <p>Will auto reload in {waitSec} sec.</p>\n    </div>\n  );\n});\n","import React, { useState } from \"react\";\nimport { useSnapshot } from \"valtio\";\n\nimport \"./SingleRoomEntrance.css\";\nimport { singleRoomState, setConfig } from \"../states/singleRoom\";\nimport { secureRandomId, generateCryptoKey } from \"../utils/crypto\";\nimport { ROOM_ID_PREFIX_LEN } from \"../network/room\";\nimport { useVideoDevices, useAudioDevices } from \"../hooks/useAvailableDevices\";\n\nconst Landing = React.lazy(() => import(\"./Landing\"));\nconst SingleRoom = React.lazy(() => import(\"./SingleRoom\"));\n\nexport const SingleRoomEntrance = React.memo(() => {\n  const { roomId, roomEntered, config } = useSnapshot(singleRoomState);\n  const [name, setName] = useState(config.nickname);\n  const [takePhoto, setTakePhoto] = useState(config.takePhoto);\n  const [avatar, setAvatar] = useState(config.avatar);\n  const videoDevices = useVideoDevices();\n  const audioDevices = useAudioDevices();\n  const [videoDeviceId, setVideoDeviceId] = useState(config.videoDeviceId);\n  const [audioDeviceId, setAudioDeviceId] = useState(config.audioDeviceId);\n  const [entering, setEntering] = useState(false);\n\n  const onChangeAvatar = (files: FileList | null) => {\n    const file = files && files[0];\n    if (!file) {\n      return;\n    }\n    if (file.size > 16 * 1024) {\n      // eslint-disable-next-line no-alert\n      window.alert(`Too large: ${file.size}`);\n      return;\n    }\n    const reader = new FileReader();\n    reader.onload = () => {\n      if (typeof reader.result === \"string\") {\n        setAvatar(reader.result);\n      }\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const onEnter = async () => {\n    setEntering(true);\n    if (!singleRoomState.roomId) {\n      singleRoomState.roomId =\n        secureRandomId(ROOM_ID_PREFIX_LEN / 2) + (await generateCryptoKey());\n    }\n    setConfig(avatar, name, takePhoto, videoDeviceId, audioDeviceId);\n    singleRoomState.roomEntered = true;\n  };\n\n  if (roomId && roomEntered) {\n    return <SingleRoom />;\n  }\n\n  return (\n    <div className=\"SingleRoomEntrance-container\">\n      <Landing>\n        <div className=\"SingleRoomEntrance-input\">\n          <div>\n            <img src={avatar} alt=\"avatar\" />\n          </div>\n          <div>\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={(e) => onChangeAvatar(e.target.files)}\n            />\n          </div>\n          <div>\n            <label>\n              <input\n                type=\"checkbox\"\n                checked={takePhoto}\n                onChange={(e) => setTakePhoto(e.target.checked)}\n              />\n              Take photo every 2 min\n            </label>\n          </div>\n          <div>\n            <input\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"Enter nickname\"\n            />\n          </div>\n          <div>\n            Video:{\" \"}\n            <select\n              value={videoDeviceId}\n              onChange={(e) => {\n                setVideoDeviceId(e.target.value);\n              }}\n            >\n              {videoDevices.map((videoDevice) => (\n                <option key={videoDevice.deviceId} value={videoDevice.deviceId}>\n                  {videoDevice.label}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div>\n            Audio:{\" \"}\n            <select\n              value={audioDeviceId}\n              onChange={(e) => {\n                setAudioDeviceId(e.target.value);\n              }}\n            >\n              {audioDevices.map((audioDevice) => (\n                <option key={audioDevice.deviceId} value={audioDevice.deviceId}>\n                  {audioDevice.label}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div>\n            <button\n              type=\"button\"\n              onClick={onEnter}\n              disabled={entering || !name}\n            >\n              {roomId ? \"Enter the room\" : \"Create a new room\"}\n            </button>\n          </div>\n        </div>\n      </Landing>\n    </div>\n  );\n});\n","import React from \"react\";\n\nimport \"./GitHubCorner.css\";\n\n// http://tholman.com/github-corners/\nexport const GitHubCorner = React.memo<{\n  size?: number;\n  fill?: string;\n  color?: string;\n}>(({ size, fill, color }) => (\n  <a\n    href=\"https://github.com/dai-shi/remote-faces\"\n    className=\"GitHubCorner-container\"\n    aria-label=\"View source on GitHub\"\n    target=\"_blank\"\n    rel=\"noopener noreferrer\"\n  >\n    <svg\n      width={size || 80}\n      height={size || 80}\n      viewBox=\"0 0 250 250\"\n      style={{\n        fill: fill || \"#151513\",\n        color: color || \"#fff\",\n        position: \"absolute\",\n        top: 0,\n        border: 0,\n        right: 0,\n      }}\n      aria-hidden=\"true\"\n    >\n      <path d=\"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z\" />\n      <path\n        d=\"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2\"\n        fill=\"currentColor\"\n        style={{ transformOrigin: \"130px 106px\" }}\n        className=\"GitHubCorner-octo-arm\"\n      />\n      <path\n        d=\"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z\"\n        fill=\"currentColor\"\n        className=\"GitHubCorner-octo-body\"\n      />\n    </svg>\n  </a>\n));\n","import React, { Suspense } from \"react\";\n\nimport \"./App.css\";\nimport { ErrorFallback } from \"./ErrorFallback\";\nimport { SuspenseFallback } from \"./SuspenseFallback\";\nimport { SingleRoomEntrance } from \"./SingleRoomEntrance\";\nimport { GitHubCorner } from \"./GitHubCorner\";\n\nclass ErrorBoundary extends React.PureComponent {\n  state: { err?: Error } = {};\n\n  static getDerivedStateFromError(err: Error) {\n    return { err };\n  }\n\n  render() {\n    const { children } = this.props;\n    const { err } = this.state;\n    if (err) return <ErrorFallback err={err} />;\n    return children;\n  }\n}\n\nexport const App = React.memo(() => (\n  <div className=\"App\">\n    <ErrorBoundary>\n      <Suspense fallback={<SuspenseFallback />}>\n        <SingleRoomEntrance />\n        <GitHubCorner size={40} fill=\"gray\" />\n      </Suspense>\n    </ErrorBoundary>\n  </div>\n));\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport { App } from \"./components/App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}