(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[15],{1143:function(e,t,n){},1153:function(e,t,n){"use strict";n.r(t),n.d(t,"VideoShare",(function(){return j}));var a=n(5),r=n(0),c=n.n(r),u=(n(1143),n(1)),i=n.n(u),o=n(108),s=n(114),l=n(2),m=n(292),d=n(121),f=n(467),b=n(209),v=c.a.memo((function(e){var t=e.nickname,n=e.stream,a=Object(r.useRef)(null);return Object(r.useEffect)((function(){n&&a.current&&(a.current.srcObject=n)}),[n]),c.a.createElement("div",null,c.a.createElement("div",{className:"VideoShare-nickname"},t),c.a.createElement("video",{className:"VideoShare-video",ref:a,autoPlay:!0,muted:!0}))})),j=c.a.memo((function(e){var t=e.roomId,n=e.userId,u=e.nickname,j=Object(f.b)(),O=Object(r.useState)(),p=Object(a.a)(O,2),h=p[0],E=p[1],S=Object(r.useState)(!1),k=Object(a.a)(S,2),w=k[0],y=k[1],V=function(e,t,n,c,u){var f=Object(r.useState)(null),b=Object(a.a)(f,2),v=b[0],j=b[1],O=Object(r.useState)({}),p=Object(a.a)(O,2),h=p[0],E=p[1],S=Object(r.useRef)([]);Object(r.useEffect)((function(){return function(){S.current.forEach((function(e){return e()}))}}),[]);var k=Object(r.useCallback)(function(){var e=Object(l.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E((function(e){return Object(s.a)(Object(s.a)({},e),{},Object(o.a)({},n.userId,new MediaStream([t])))})),a=function(){E((function(e){return Object(s.a)(Object(s.a)({},e),{},Object(o.a)({},n.userId,null))}))},t.addEventListener("ended",a),S.current.push((function(){t.removeEventListener("ended",a)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),w=Object(d.c)(e,t,k,"cameraVideo");return Object(r.useEffect)((function(){var e=null;return n&&w&&Object(l.a)(i.a.mark((function t(){var n,r,o,s,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.b)(u);case 2:n=t.sent,r=n.stream.getVideoTracks(),o=Object(a.a)(r,1),s=o[0],l=w(s),j(n.stream),e=function(){l(),n.dispose(),j(null),c(!1)},s.addEventListener("ended",(function(){e&&e(),e=null}));case 8:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,u,n,c,w]),{videoStream:v,videoStreamMap:h}}(t,n,w,y,h),I=V.videoStream,N=V.videoStreamMap,g=Object(b.a)(t,n),C=(I?1:0)+Object.values(N).filter((function(e){return e})).length;return c.a.createElement("div",{className:"VideoShare-container"},c.a.createElement("div",null,"Select Camera:"," ",c.a.createElement("select",{value:h,onChange:function(e){return E(e.target.value)}},j.map((function(e){return c.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),c.a.createElement("button",{type:"button",onClick:function(){return y(!w)}},w?"Stop video share":"Start video share"),c.a.createElement("div",{className:"VideoShare-body",style:{gridTemplateColumns:"repeat(".concat(Math.ceil(Math.sqrt(C)),", 1fr)")}},I&&c.a.createElement(v,{nickname:u,stream:I}),Object.keys(N).map((function(e){var t=N[e];return t?c.a.createElement(v,{key:e,nickname:g[e]||"No Name",stream:t}):null}))))}));t.default=j}}]);
//# sourceMappingURL=15.8a0ee8f7.chunk.js.map