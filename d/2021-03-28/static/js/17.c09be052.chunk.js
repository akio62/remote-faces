(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[17],{1268:function(e,t,n){},1284:function(e,t,n){"use strict";n.r(t),n.d(t,"ScreenShare",(function(){return p}));var r=n(4),c=n(0),a=n(1),u=n.n(a),s=(n(1268),n(2)),i=n.n(s),o=n(3),f=n(16),b=n(95),j=n(17),d=n(332),O=n(105),v="screenVideo",m=n(151),l=u.a.memo((function(e){var t=e.nickname,n=e.stream,r=Object(a.useRef)(null);return Object(a.useEffect)((function(){n&&r.current&&(r.current.srcObject=n)}),[n]),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:"ScreenShare-nickname",children:t}),Object(c.jsx)("video",{className:"ScreenShare-video",ref:r,autoPlay:!0,muted:!0})]})})),p=u.a.memo((function(e){var t=e.roomId,n=e.userId,u=e.nickname,s=Object(a.useState)(!1),p=Object(r.a)(s,2),h=p[0],S=p[1],k=function(e,t,n,c){var u=Object(a.useState)(null),s=Object(r.a)(u,2),m=s[0],l=s[1],p=Object(a.useState)({}),h=Object(r.a)(p,2),S=h[0],k=h[1],x=Object(a.useRef)([]);Object(a.useEffect)((function(){return function(){x.current.forEach((function(e){return e()}))}}),[]);var y=Object(j.useSnapshot)(Object(O.a)(e,t).trackMap);return Object.entries(y[v]||{}).forEach((function(e){var t,n=Object(r.a)(e,2),c=n[0],a=n[1];if("ended"!==a.readyState&&!(null===(t=S[c])||void 0===t?void 0:t.getTracks().includes(a))){k((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(f.a)({},c,new MediaStream([a])))}));var u=function(){k((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(f.a)({},c,null))}))};a.addEventListener("ended",u),x.current.push((function(){a.removeEventListener("ended",u)}))}})),Object(a.useEffect)((function(){var n=Object(O.a)(e,t);return n.addMediaType(v),function(){n.removeMediaType(v)}}),[e,t]),Object(a.useEffect)((function(){var a=Object(O.a)(e,t),u=null;return n&&Object(o.a)(i.a.mark((function e(){var t,n,s,o,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)();case 2:if(t=e.sent){e.next=6;break}return c(!1),e.abrupt("return");case 6:n=t.stream.getVideoTracks(),s=Object(r.a)(n,1),o=s[0],a.addTrack(v,o),l(t.stream),o.addEventListener("ended",(function(){u&&u(),u=null})),f=function(){a.removeTrack(v),t.dispose(),l(null),c(!1)},!1===u?f():u=f;case 12:case"end":return e.stop()}}),e)})))(),function(){u&&u(),u=!1}}),[e,t,n,c]),{screenStream:m,screenStreamMap:S}}(t,n,h,S),x=k.screenStream,y=k.screenStreamMap,E=Object(m.a)(t,n);return Object(c.jsxs)("div",{className:"ScreenShare-container",children:[Object(c.jsx)("button",{type:"button",onClick:function(){return S(!h)},children:h?"Stop screen share":"Start screen share"}),Object(c.jsxs)("div",{className:"ScreenShare-body",children:[x&&Object(c.jsx)(l,{nickname:u,stream:x}),Object.keys(y).map((function(e){var t=y[e];return t?Object(c.jsx)(l,{nickname:E[e]||"No Name",stream:t},e):null}))]})]})}));t.default=p},151:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(95),c=n(4),a=n(1),u=n(108),s=n(105),i=function(e,t){var n=Object(a.useState)({}),i=Object(c.a)(n,2),o=i[0],f=i[1];return Object(a.useEffect)((function(){var n=Object(s.a)(e,t).ydoc.getMap("faceImages"),c=function(){f((function(e){var c=Object(r.a)({},e),a=!1;return n.forEach((function(e,n){var r;n!==t&&(r=e,Object(u.c)(r)&&Object(u.c)(r.info)&&"string"===typeof r.info.nickname&&(c[n]?e.info.nickname!==c[n]&&(c[n]=e.info.nickname,a=!0):(c[n]=e.info.nickname,a=!0)))})),a?c:e}))};return n.observe(c),c(),function(){n.unobserve(c)}}),[e,t]),o}},332:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(2),c=n.n(r),a=n(4),u=n(3),s=function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r,u,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={video:!0},e.next=4,navigator.mediaDevices.getDisplayMedia(t);case 4:return n=e.sent,r=n.getVideoTracks(),u=Object(a.a)(r,1),s=u[0],i=function(){s.stop()},e.abrupt("return",{stream:n,dispose:i});case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=17.c09be052.chunk.js.map