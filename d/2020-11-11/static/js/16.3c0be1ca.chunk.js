(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[16],{1232:function(e,a,t){},1255:function(e,a,t){"use strict";t.r(a),t.d(a,"SpatialArea",(function(){return A}));var n=t(1),r=t.n(n),c=t(2),i=t(5),u=t(0),o=t.n(u),l=t(332),s=t(1246),v=t(1244),m=(t(1232),t(112)),f=t(119),p=t(108),b=t(125),d=function(e,a){var t=Object(u.useState)({}),n=Object(i.a)(t,2),r=n[0],c=n[1],o=Object(u.useState)(),l=Object(i.a)(o,2),s=l[0],v=l[1],d=Object(u.useRef)();Object(u.useEffect)((function(){d.current=s}),[s]);var j=Object(b.a)(e,a),O=Object(u.useRef)();return Object(u.useEffect)((function(){if(s){var e={spatialArea:"avatar",userId:a,avatarData:s};O.current?O.current=e:(O.current=e,setTimeout((function(){j(O.current),O.current=void 0}),200))}}),[j,a,s]),Object(b.b)(e,a,Object(u.useCallback)((function(e){var a;if(a=e,Object(p.c)(a)&&("init"===a.spatialArea||"avatar"===a.spatialArea&&function(e){try{var a=e;return"number"===typeof a.position[0]&&"number"===typeof a.position[1]&&"number"===typeof a.position[2]}catch(t){return!1}}(a.avatarData)))if("init"===e.spatialArea)d.current&&j({spatialArea:"avatar",avatarData:d.current});else if("avatar"===e.spatialArea){var t=e.userId,n=e.avatarData;c((function(e){return Object(f.a)(Object(f.a)({},e),{},Object(m.a)({},t,n))}))}}),[j])),Object(u.useEffect)((function(){j({spatialArea:"init"})}),[j]),{avatarMap:r,myAvatar:s,setMyAvatar:v}},j=t(333),O=t(523),E=t(206),S=o.a.memo((function(e){var a=e.nickname,t=e.faceStream,n=e.position,m=e.setPosition,f=Object(s.b)(),p=f.size,b=f.viewport,d=p.width/b.width,j=Object(u.useRef)(),O=Object(v.a)((function(e){var a=e.first,t=Object(i.a)(e.initial,2),r=t[0],c=t[1],u=Object(i.a)(e.xy,2),o=u[0],l=u[1];a&&(j.current=n);var s=j.current,v=Object(i.a)(s,2),f=v[0],p=v[1];m&&m([f+(o-r)/d,p-(l-c)/d,0])})),E=Object(u.useState)(),S=Object(i.a)(E,2),k=S[0],y=S[1];return Object(u.useEffect)((function(){var e=null===t||void 0===t?void 0:t.getVideoTracks()[0];if(e){var n=document.createElement("canvas"),i=new l.CanvasTexture(n);y(i);var u=new ImageCapture(e),o=n.getContext("2d"),s=setInterval(Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.grabFrame();case 3:t=e.sent,n.width=t.width,n.height=t.height,o.drawImage(t,0,0),o.font="18px selif",o.textBaseline="top",o.fillStyle="blue",o.fillText(a,2,2),i.needsUpdate=!0,e.next=16;break;case 14:e.prev=14,e.t0=e.catch(0);case 16:case"end":return e.stop()}}),e,null,[[0,14]])}))),1e3/7.5);return function(){clearInterval(s)}}}),[a,t]),k?o.a.createElement("sprite",Object.assign({},m&&O(),{position:n}),o.a.createElement("spriteMaterial",{map:k})):null})),k=function(e){return[parseInt(e.slice(0,2),16)/128-1,parseInt(e.slice(2,4),16)/128-1,0]},y=o.a.memo((function(e){var a=e.userId,t=e.nickname,n=e.faceStream,r=e.nicknameMap,c=e.faceStreamMap,i=e.avatarMap,l=e.myAvatar,v=e.setMyAvatar,m=function(e){var a;return(null===(a=i[e])||void 0===a?void 0:a.position)||k(e)};return o.a.createElement(s.a,null,o.a.createElement(u.Suspense,{fallback:null},o.a.createElement("ambientLight",null),Object.keys(c).map((function(e){return e!==a&&o.a.createElement(S,{key:e,nickname:r[e]||"",faceStream:c[e]||null,position:m(e)})})),o.a.createElement(S,{nickname:t,faceStream:n,position:(null===l||void 0===l?void 0:l.position)||k(a),setPosition:function(e){v({position:e})}})))})),A=o.a.memo((function(e){var a=e.roomId,t=e.userId,n=e.nickname,r=Object(j.b)(),c=Object(u.useState)(""),l=Object(i.a)(c,2),s=l[0],v=l[1],m=Object(j.a)(),f=Object(u.useState)(""),p=Object(i.a)(f,2),b=p[0],S=p[1],k=Object(O.a)(a,t,!!s,!!b,!!b,s,b,"spatialArea"),A=k.faceStream,h=k.faceStreamMap,I=Object(E.a)(a,t),M=d(a,t),w=M.avatarMap,g=M.myAvatar,x=M.setMyAvatar;return o.a.createElement("div",{className:"SpatialArea-container"},o.a.createElement("div",null,"Select Camera:"," ",o.a.createElement("select",{value:s,onChange:function(e){return v(e.target.value)}},o.a.createElement("option",{value:""},"None"),r.map((function(e){return o.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),o.a.createElement("div",null,"Select Mic:"," ",o.a.createElement("select",{value:b,onChange:function(e){S(e.target.value)}},o.a.createElement("option",{value:""},"None"),m.map((function(e){return o.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),o.a.createElement("div",{className:"SpatialArea-body"},o.a.createElement(y,{userId:t,nickname:n,faceStream:A,nicknameMap:I,faceStreamMap:h,avatarMap:w,myAvatar:g,setMyAvatar:x})))}));a.default=A}}]);
//# sourceMappingURL=16.3c0be1ca.chunk.js.map