(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[20],{1252:function(e,t,n){},1275:function(e,t,n){"use strict";n.r(t),n.d(t,"GatherArea",(function(){return O}));var r=n(95),a=n(4),i=n(0),c=n(1),o=n.n(c),s=(n(1252),n(14)),u=n(107),b=n(532),j=n(329),d=o.a.memo((function(e){var t=e.roomId,n=e.userId,r=Object(c.useState)(""),o=Object(a.a)(r,2),s=o[0],b=o[1],j=Object(c.useState)(!1),d=Object(a.a)(j,2),p=d[0],f=d[1],l=Object(c.useState)(100),O=Object(a.a)(l,2),g=O[0],m=O[1],v=Object(c.useState)(100),h=Object(a.a)(v,2),x=h[0],M=h[1],y=Object(c.useState)(100),I=Object(a.a)(y,2),k=I[0],z=I[1],S=Object(c.useState)(100),A=Object(a.a)(S,2),C=A[0],N=A[1],R=Object(c.useState)(0),D=Object(a.a)(R,2),E=D[0],w=D[1],G=Object(c.useState)(""),T=Object(a.a)(G,2),B=T[0],J=T[1],P=Object(c.useState)(""),X=Object(a.a)(P,2),Y=X[0],H=X[1];return Object(i.jsxs)("div",{className:"RegionEditor-container",children:[Object(i.jsx)("h3",{children:"Region Editor"}),Object(i.jsxs)("label",{children:["Region ID:"," ",Object(i.jsx)("input",{value:s,onChange:function(e){return b(e.target.value)}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Is Meeting:"," ",Object(i.jsx)("input",{type:"checkbox",checked:p,onChange:function(){return f((function(e){return!e}))}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Left:"," ",Object(i.jsx)("input",{type:"number",value:g,onChange:function(e){return m(Number(e.target.value))}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Top:"," ",Object(i.jsx)("input",{type:"number",value:x,onChange:function(e){return M(Number(e.target.value))}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Width:"," ",Object(i.jsx)("input",{type:"number",value:k,onChange:function(e){return z(Number(e.target.value))}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Height:"," ",Object(i.jsx)("input",{type:"number",value:C,onChange:function(e){return N(Number(e.target.value))}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["zIndex:"," ",Object(i.jsx)("input",{type:"number",value:E,max:0,onChange:function(e){return w(Number(e.target.value))}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Background:"," ",Object(i.jsx)("input",{value:B,onChange:function(e){return J(e.target.value)}})]}),Object(i.jsx)("hr",{}),Object(i.jsxs)("label",{children:["Iframe:"," ",Object(i.jsx)("input",{value:Y,onChange:function(e){return H(e.target.value)}})]}),Object(i.jsx)("hr",{}),Object(i.jsx)("button",{type:"button",onClick:function(){return function(){var e={isMeeting:p,position:[g,x],size:[k,C],zIndex:E,background:B,iframe:Y};Object(u.a)(t,n).ydoc.getMap("gatherRegionMap").set(s,e)}()},disabled:!s,children:"Add Region"})]})})),p=n(337),f=o.a.memo((function(e){var t=e.id,n=e.data,r=e.highlight,a=n.isMeeting&&(r?"0 0 0 5px pink":"0 0 0 1px pink")||void 0;return Object(i.jsx)("div",{className:"GatherArea-region",style:{left:"".concat(n.position[0],"px"),top:"".concat(n.position[1],"px"),width:"".concat(n.size[0],"px"),height:"".concat(n.size[1],"px"),boxShadow:a,zIndex:n.zIndex,background:n.background},children:n.iframe&&Object(i.jsx)("iframe",{title:t,src:n.iframe,frameBorder:"0"})})})),l=o.a.memo((function(e){var t=e.nickname,n=e.statusMesg,r=e.image,a=e.position,c=e.setPosition,o=e.registerOnMouseDrag,s=e.stream,u=e.muted,b=!!c;return Object(i.jsx)("div",{className:"GatherArea-avatar",style:{left:"".concat(a[0],"px"),top:"".concat(a[1],"px")},role:"button",tabIndex:-1,onMouseDown:function(e){if(e.preventDefault(),b){var t=e.currentTarget,n=[e.clientX-a[0],e.clientY-a[1]];o((function(e){var r=e.clientX-n[0],a=e.clientY-n[1];t.style.left="".concat(r,"px"),t.style.top="".concat(a,"px"),null===c||void 0===c||c([r,a])}))}},children:Object(i.jsx)(p.a,{image:r,nickname:t,statusMesg:n,obsoleted:!1,liveMode:!!s,stream:s,muted:!!u,micOn:!!s,speakerOn:!!s})})})),O=o.a.memo((function(e){var t=e.roomId,n=e.userId,o=e.avatar,p=e.nickname,O=e.statusMesg,g=e.suspended,m=e.videoDeviceId,v=e.audioDeviceId,h=Object(b.a)(t,n,o,p,O,g,!1,!1,!1,m),x=h.myImage,M=h.roomImages,y=function(e,t){var n,i=Object(c.useState)({}),o=Object(a.a)(i,2),b=o[0],j=o[1],d=Object(c.useState)({position:(n=t,[parseInt(n.slice(0,2),16)/2+20,parseInt(n.slice(2,4),16)/2+20])}),p=Object(a.a)(d,2),f=p[0],l=p[1];Object(c.useEffect)((function(){var n=Object(u.a)(e,t),a=n.ydoc.getMap("gatherAvatarMap"),i=function(){j((function(e){var i=Object(r.a)({},e),c=!1;return a.forEach((function(e,r){var a,o;r!==t&&n.userIdMap[r]&&function(e){try{var t=e;return"number"===typeof t.position[0]&&"number"===typeof t.position[1]}catch(n){return!1}}(e)&&(i[r]?(a=e,o=i[r],(a.position[0]!==o.position[0]||a.position[1]!==o.position[1])&&(i[r]=e,c=!0)):(i[r]=e,c=!0))})),Object.keys(i).forEach((function(e){n.userIdMap[e]||(delete i[e],c=!0)})),c?i:e}))};a.observe(i);var c=Object(s.d)(n.userIdMap,i);return i(),function(){c(),a.unobserve(i)}}),[e,t]);var O=Object(c.useRef)();Object(c.useEffect)((function(){f&&(O.current?O.current=f:(O.current=f,setTimeout((function(){Object(u.a)(e,t).ydoc.getMap("gatherAvatarMap").set(t,O.current),O.current=void 0}),500)))}),[e,t,f]);var g=Object(c.useState)({}),m=Object(a.a)(g,2),v=m[0],h=m[1];Object(c.useEffect)((function(){var n=Object(u.a)(e,t).ydoc.getMap("gatherRegionMap"),r=function(){h((function(e){var t={};return n.forEach((function(n,r){var a,i;(function(e){try{var t=e;return!("boolean"!==typeof t.isMeeting||"number"!==typeof t.position[0]||"number"!==typeof t.position[1]||"number"!==typeof t.size[0]||"number"!==typeof t.size[1]||"undefined"!==typeof t.zIndex&&"number"!==typeof t.zIndex||"undefined"!==typeof t.background&&"string"!==typeof t.background||"undefined"!==typeof t.iframe&&"string"!==typeof t.iframe)}catch(n){return!1}})(n)&&(e[r]&&(i=n,(a=e[r]).isMeeting===i.isMeeting&&a.position[0]===i.position[0]&&a.position[1]===i.position[1]&&a.size[0]===i.size[0]&&a.size[1]===i.size[1]&&a.zIndex===i.zIndex&&a.background===i.background&&a.iframe===i.iframe)?t[r]=e[r]:t[r]=n)})),t}))};return n.observe(r),r(),function(){n.unobserve(r)}}),[e,t]);var x=Object(c.useCallback)((function(n,r){Object(u.a)(e,t).ydoc.getMap("gatherRegionMap").set(n,r)}),[e,t]);return{avatarMap:b,myAvatar:f,setMyAvatar:l,regionMap:v,updateRegion:x}}(t,n),I=y.avatarMap,k=y.myAvatar,z=y.setMyAvatar,S=y.regionMap,A=Object(c.useRef)(),C=Object(c.useCallback)((function(e){A.current=e}),[]),N=Object.keys(S).sort((function(e,t){var n,r;return(null!==(n=S[t].zIndex)&&void 0!==n?n:0)-(null!==(r=S[e].zIndex)&&void 0!==r?r:0)})).find((function(e){var t=S[e],n=t.isMeeting,r=t.position,a=t.size;return n&&r[0]<=k.position[0]&&r[1]<=k.position[1]&&k.position[0]+36<=r[0]+a[0]&&k.position[1]+36<=r[1]+a[1]})),R=Object(j.a)(t,n,!!N,!!N,!0,m,v,"gatherArea/meeting/".concat(N,"/")),D=R.faceStream,E=R.faceStreamMap,w=Object(c.useState)(!1),G=Object(a.a)(w,2),T=G[0],B=G[1];return Object(i.jsxs)("div",{className:"GatherArea-container",children:[Object(i.jsxs)("div",{className:"GatherArea-body",role:"button",tabIndex:-1,onMouseDown:function(e){e.preventDefault()},onMouseMove:function(e){A.current&&A.current(e)},onMouseUp:function(){C()},children:[Object.entries(S).map((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(i.jsx)(f,{id:n,data:r,highlight:n===N},n)})),Object.entries(I).map((function(e){var t=Object(a.a)(e,2),r=t[0],c=t[1];if(r===n)return null;var o=M.find((function(e){return e.userId===r}));return o?Object(i.jsx)(l,{nickname:o.info.nickname,statusMesg:o.info.message,image:o.image,position:c.position,registerOnMouseDrag:C,stream:E[r]},r):null})),Object(i.jsx)(l,{nickname:p,statusMesg:O,image:x,position:k.position,setPosition:function(e){return z((function(t){return Object(r.a)(Object(r.a)({},t),{},{position:e})}))},registerOnMouseDrag:C,stream:D||void 0,muted:!0})]}),Object(i.jsx)("div",{className:"GatherArea-toolbar",children:Object(i.jsxs)("div",{children:[Object(i.jsx)("button",{type:"button",onClick:function(){return B((function(e){return!e}))},children:T?"Close Region Editor":"Open Region Editor"}),T&&Object(i.jsx)("div",{className:"GatherArea-region-editor",children:Object(i.jsx)(d,{roomId:t,userId:n})})]})})]})}));t.default=O}}]);
//# sourceMappingURL=20.4d404b29.chunk.js.map