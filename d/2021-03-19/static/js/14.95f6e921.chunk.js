(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[14],{1248:function(e,t,n){},1251:function(e,t,n){},1273:function(e,t,n){"use strict";n.r(t),n.d(t,"MomentaryChat",(function(){return A}));var r=n(4),a=n(0),c=n(1),i=n.n(c),o=n(1247),s=n.n(o),u=(n(1248),n(95)),l=n(13),b=n(9),f=n(106),d=n(107),m=function(e){return Array.isArray(e)&&2===e.length&&"string"===typeof e[0]&&"number"===typeof e[1]},h=function(e){return Object(f.c)(e)&&"string"===typeof e.nickname&&"string"===typeof e.messageId&&"number"===typeof e.createdAt&&"string"===typeof e.text&&function(e){return Array.isArray(e)&&e.every(m)}(e.replies)},j=function(e,t){var n=t[1]-e[1];return 0===n?e[0].length-t[0].length:n},y=n(326),O=n(1249),g=n(1250),p=n.n(g),C=(n(1251),{toolbar:["specialCharacters","|","bold","italic","link","blockQuote","|","imageUpload","insertTable","mediaEmbed","|","undo","redo"],balloonToolbar:["heading","|","bulletedList","numberedList","indent","outdent"],link:{addTargetToExternalLinks:!0}}),v=i.a.memo((function(e){var t=e.registerClear,n=e.onChange,r=e.onMetaEnter;return Object(a.jsx)(O.CKEditor,{editor:p.a,config:C,onReady:function(e){e.sourceElement.addEventListener("keydown",(function(e){e.metaKey&&"Enter"===e.code&&r()})),t((function(){e.setData("")})),function(e){e.plugins.get("SpecialCharacters").addItems("Emoji",[{title:"smiley face",character:"\ud83d\ude0a"},{title:"rocket",character:"\ud83d\ude80"},{title:"wind blowing face",character:"\ud83c\udf2c\ufe0f"},{title:"floppy disk",character:"\ud83d\udcbe"},{title:"heart",character:"\u2764\ufe0f"}])}(e)},onChange:function(e,t){var r=t.getData();n(r)}})})),x=1048576,k=function(e){return new Date(e.createdAt).toLocaleString().split(" ")[1].slice(0,-3)},N=i.a.memo((function(e){var t,n=e.item,i=e.replyChat,o=Object(c.useState)(!1),u=Object(r.a)(o,2),l=u[0],b=u[1],f=function(e){return i(e,n.messageId)};return Object(a.jsxs)("li",{className:"MomentaryChat-listPart",children:[l&&Object(a.jsx)(y.b,{onSelect:function(e){f(e.native),b(!1)},style:{width:"100%"}}),Object(a.jsxs)("div",{className:"MomentaryChat-listPart-header",children:[Object(a.jsx)("div",{className:"MomentaryChat-iconButton-container",children:Object(a.jsx)("div",{className:"MomentaryChat-iconButton",children:Object(a.jsx)("button",{type:"button",onClick:function(){b(!l)},children:"+"})})}),Object(a.jsx)("span",{className:"MomentaryChat-nickname",children:n.nickname||"No Name"}),Object(a.jsx)("span",{className:"MomentaryChat-time",children:k(n)})]}),Object(a.jsx)("div",{className:"MomentaryChat-text ck-content",dangerouslySetInnerHTML:(t=n.text,{__html:s.a.sanitize(t,{ADD_ATTR:["target"]})})}),(n.replies||[]).map((function(e){var t=Object(r.a)(e,2),n=t[0],c=t[1];return Object(a.jsxs)("button",{className:"MomentaryChat-icon",type:"button",onClick:function(){return f(n)},children:[n," ",c]},n)}))]},n.messageId)})),M=i.a.memo((function(e){var t,n=e.chatList,r=e.replyChat,i=Object(c.useRef)(null),o=null===(t=n[0])||void 0===t?void 0:t.messageId;return Object(c.useEffect)((function(){i.current&&o&&(i.current.scrollTop=i.current.scrollHeight)}),[o]),Object(a.jsx)("ul",{className:"MomentaryChat-list",ref:i,children:n.map((function(e){return Object(a.jsx)(N,{item:e,replyChat:r},e.messageId)}))})})),A=i.a.memo((function(e){var t=e.roomId,n=e.userId,i=e.nickname,o=Object(c.useRef)(null),s=function(e,t,n){var a=Object(c.useState)([]),i=Object(r.a)(a,2),o=i[0],s=i[1];return Object(c.useEffect)((function(){var n=Object(d.a)(e,t).ydoc.getArray("momentrayChat"),r=function(){s(n.toArray().filter(h))};return n.observe(r),r(),function(){n.unobserve(r)}}),[e,t]),{chatList:o,sendChat:Object(c.useCallback)((function(r){var a=Object(d.a)(e,t).ydoc.getArray("momentrayChat"),c={nickname:n,messageId:Object(b.j)(),createdAt:Date.now(),text:r,replies:[]};a.unshift([c]),a.length>100&&a.delete(a.length-1,1),s(a.toArray().filter(h))}),[e,t,n]),replyChat:Object(c.useCallback)((function(n,r){var a=Object(d.a)(e,t).ydoc.getArray("momentrayChat");a.forEach((function(e,t){if(h(e)&&e.messageId===r){var c=new Map(e.replies);c.set(n,(c.get(n)||0)+1);var i=Object(l.a)(c.entries());i.sort(j),a.delete(t,1),a.insert(t,[Object(u.a)(Object(u.a)({},e),{},{replies:i})])}})),s(a.toArray().filter(h))}),[e,t])}}(t,n,i),f=s.chatList,m=s.sendChat,y=s.replyChat,O=Object(c.useRef)(),g=Object(c.useState)(!1),p=Object(r.a)(g,2),C=p[0],k=p[1],N=Object(c.useRef)(""),A=Object(c.useCallback)((function(e){N.current=e,k(!!e&&e.length<=x)}),[]),w=Object(c.useCallback)((function(){N.current&&N.current.length<=x&&(m(N.current),A(""),O.current&&O.current())}),[m,A]),E=function(){var e=Object(c.useRef)(),t=Object(c.useCallback)((function(t){"granted"===Notification.permission&&(e.current&&e.current.close(),e.current=new Notification(t))}),[]);return Object(c.useEffect)((function(){"granted"!==Notification.permission&&Notification.requestPermission()}),[]),t}(),I=f[0];return Object(c.useEffect)((function(){I&&I.createdAt>Date.now()-1e4&&new RegExp("@".concat(i,"\\b")).test(I.text)&&E("You got a new message!")}),[i,I,E]),Object(a.jsxs)("div",{className:"MomentaryChat-container",ref:o,children:[Object(a.jsx)(M,{chatList:f,replyChat:y}),Object(a.jsx)("div",{className:"MomentaryChat-editor",children:Object(a.jsx)(v,{registerClear:function(e){O.current=e},onChange:A,onMetaEnter:w})}),Object(a.jsx)("div",{className:"MomentaryChat-button",children:Object(a.jsx)("button",{type:"button",onClick:w,disabled:!C,children:"Send"})})]})}));t.default=A},326:function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));n(527);var r=n(173);n.d(t,"a",(function(){return r.a}));var a=r.b}}]);
//# sourceMappingURL=14.95f6e921.chunk.js.map