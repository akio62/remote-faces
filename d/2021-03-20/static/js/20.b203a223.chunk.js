(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[20],{1241:function(e,t,n){},1274:function(e,t,n){"use strict";n.r(t),n.d(t,"GatherArea",(function(){return g}));var a=n(95),r=n(4),c=n(0),i=n(1),o=n.n(i),s=(n(1241),n(14)),u=n(107),b=n(532),j=n(329),d=o.a.memo((function(e){var t=e.roomId,n=e.userId,a=Object(i.useState)(""),o=Object(r.a)(a,2),s=o[0],b=o[1],j=Object(i.useState)("background"),d=Object(r.a)(j,2),l=d[0],p=d[1],O=Object(i.useState)(100),f=Object(r.a)(O,2),m=f[0],g=f[1],h=Object(i.useState)(100),v=Object(r.a)(h,2),x=v[0],y=v[1],I=Object(i.useState)(100),M=Object(r.a)(I,2),k=M[0],z=M[1],S=Object(i.useState)(100),A=Object(r.a)(S,2),C=A[0],N=A[1],R=Object(i.useState)(0),E=Object(r.a)(R,2),D=E[0],w=E[1],G=Object(i.useState)(""),T=Object(r.a)(G,2),B=T[0],P=T[1],J=Object(i.useState)(""),X=Object(r.a)(J,2),Y=X[0],q=X[1];return Object(c.jsxs)("div",{className:"RegionEditor-container",children:[Object(c.jsx)("h3",{children:"Region Editor"}),Object(c.jsxs)("label",{children:["Region ID:"," ",Object(c.jsx)("input",{value:s,onChange:function(e){return b(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Type:"," ",Object(c.jsxs)("select",{value:l,onChange:function(e){return p(e.target.value)},children:[Object(c.jsx)("option",{value:"background",children:"Background"}),Object(c.jsx)("option",{value:"meeting",children:"Meeting"}),Object(c.jsx)("option",{value:"chat",children:"Chat"})]})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Left:"," ",Object(c.jsx)("input",{type:"number",value:m,onChange:function(e){return g(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Top:"," ",Object(c.jsx)("input",{type:"number",value:x,onChange:function(e){return y(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Width:"," ",Object(c.jsx)("input",{type:"number",value:k,onChange:function(e){return z(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Height:"," ",Object(c.jsx)("input",{type:"number",value:C,onChange:function(e){return N(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["zIndex:"," ",Object(c.jsx)("input",{type:"number",value:D,max:0,onChange:function(e){return w(Number(e.target.value))}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Background:"," ",Object(c.jsx)("input",{value:B,onChange:function(e){return P(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)("label",{children:["Iframe:"," ",Object(c.jsx)("input",{value:Y,onChange:function(e){return q(e.target.value)}})]}),Object(c.jsx)("hr",{}),Object(c.jsx)("button",{type:"button",onClick:function(){return function(){var e={type:l,position:[m,x],size:[k,C],zIndex:D,background:B,iframe:Y};Object(u.a)(t,n).ydoc.getMap("gatherRegionMap").set(s,e)}()},disabled:!s,children:"Add Region"})]})})),l=n(337),p=n(28),O=o.a.lazy((function(){return Promise.all([n.e(0),n.e(3),n.e(4)]).then(n.bind(null,1273))})),f=o.a.memo((function(e){var t=e.roomId,n=e.userId,a=e.nickname,r=e.id,o=e.data,s=e.highlight,u="meeting"===o.type&&(s?"0 0 0 5px pink":"0 0 0 1px pink")||void 0;return Object(c.jsxs)("div",{className:"GatherArea-region",style:{left:"".concat(o.position[0],"px"),top:"".concat(o.position[1],"px"),width:"".concat(o.size[0],"px"),height:"".concat(o.size[1],"px"),boxShadow:u,zIndex:"chat"!==o.type?o.zIndex:void 0,background:o.background},children:[o.iframe&&Object(c.jsx)("iframe",{title:r,src:o.iframe,frameBorder:"0"}),"chat"===o.type&&Object(c.jsx)(i.Suspense,{fallback:Object(c.jsx)(p.a,{}),children:Object(c.jsx)(O,{roomId:t,userId:n,nickname:a,uniqueId:r})})]})})),m=o.a.memo((function(e){var t=e.nickname,n=e.statusMesg,a=e.image,r=e.position,i=e.setPosition,o=e.registerOnMouseDrag,s=e.stream,u=e.muted,b=!!i;return Object(c.jsx)("div",{className:"GatherArea-avatar",style:{left:"".concat(r[0],"px"),top:"".concat(r[1],"px")},onMouseDown:function(e){if(e.preventDefault(),b){var t=e.currentTarget,n=[e.clientX-r[0],e.clientY-r[1]];o((function(e){var a=e.clientX-n[0],r=e.clientY-n[1];t.style.left="".concat(a,"px"),t.style.top="".concat(r,"px"),null===i||void 0===i||i([a,r])}))}},children:Object(c.jsx)(l.a,{image:a,nickname:t,statusMesg:n,obsoleted:!1,liveMode:!!s,stream:s,muted:!!u,micOn:!!s,speakerOn:!!s})})})),g=o.a.memo((function(e){var t=e.roomId,n=e.userId,o=e.avatar,l=e.nickname,p=e.statusMesg,O=e.suspended,g=e.videoDeviceId,h=e.audioDeviceId,v=Object(b.a)(t,n,o,l,p,O,!1,!1,!1,g),x=v.myImage,y=v.roomImages,I=function(e,t){var n,c=Object(i.useState)({}),o=Object(r.a)(c,2),b=o[0],j=o[1],d=Object(i.useState)({position:(n=t,[parseInt(n.slice(0,2),16)/2+20,parseInt(n.slice(2,4),16)/2+20])}),l=Object(r.a)(d,2),p=l[0],O=l[1];Object(i.useEffect)((function(){var n=Object(u.a)(e,t),r=n.ydoc.getMap("gatherAvatarMap"),c=function(){j((function(e){var c=Object(a.a)({},e),i=!1;return r.forEach((function(e,a){var r,o;a!==t&&n.userIdMap[a]&&function(e){try{var t=e;return"number"===typeof t.position[0]&&"number"===typeof t.position[1]}catch(n){return!1}}(e)&&(c[a]?(r=e,o=c[a],(r.position[0]!==o.position[0]||r.position[1]!==o.position[1])&&(c[a]=e,i=!0)):(c[a]=e,i=!0))})),Object.keys(c).forEach((function(e){n.userIdMap[e]||(delete c[e],i=!0)})),i?c:e}))};r.observe(c);var i=Object(s.d)(n.userIdMap,c);return c(),function(){i(),r.unobserve(c)}}),[e,t]);var f=Object(i.useRef)();Object(i.useEffect)((function(){p&&(f.current?f.current=p:(f.current=p,setTimeout((function(){Object(u.a)(e,t).ydoc.getMap("gatherAvatarMap").set(t,f.current),f.current=void 0}),500)))}),[e,t,p]);var m=Object(i.useState)({}),g=Object(r.a)(m,2),h=g[0],v=g[1];Object(i.useEffect)((function(){var n=Object(u.a)(e,t).ydoc.getMap("gatherRegionMap"),a=function(){v((function(e){var t={};return n.forEach((function(n,a){var r,c;(function(e){try{var t=e;return!(!["background","meeting","chat"].includes(t.type)||"number"!==typeof t.position[0]||"number"!==typeof t.position[1]||"number"!==typeof t.size[0]||"number"!==typeof t.size[1]||"undefined"!==typeof t.zIndex&&"number"!==typeof t.zIndex||"undefined"!==typeof t.background&&"string"!==typeof t.background||"undefined"!==typeof t.iframe&&"string"!==typeof t.iframe)}catch(n){return!1}})(n)&&(e[a]&&(c=n,(r=e[a]).type===c.type&&r.position[0]===c.position[0]&&r.position[1]===c.position[1]&&r.size[0]===c.size[0]&&r.size[1]===c.size[1]&&r.zIndex===c.zIndex&&r.background===c.background&&r.iframe===c.iframe)?t[a]=e[a]:t[a]=n)})),t}))};return n.observe(a),a(),function(){n.unobserve(a)}}),[e,t]);var x=Object(i.useCallback)((function(n,a){Object(u.a)(e,t).ydoc.getMap("gatherRegionMap").set(n,a)}),[e,t]);return{avatarMap:b,myAvatar:p,setMyAvatar:O,regionMap:h,updateRegion:x}}(t,n),M=I.avatarMap,k=I.myAvatar,z=I.setMyAvatar,S=I.regionMap,A=Object(i.useRef)(),C=Object(i.useCallback)((function(e){A.current=e}),[]),N=Object.keys(S).sort((function(e,t){var n,a;return(null!==(n=S[t].zIndex)&&void 0!==n?n:0)-(null!==(a=S[e].zIndex)&&void 0!==a?a:0)})).find((function(e){var t=S[e],n=t.type,a=t.position,r=t.size;return"meeting"===n&&a[0]<=k.position[0]&&a[1]<=k.position[1]&&k.position[0]+36<=a[0]+r[0]&&k.position[1]+36<=a[1]+r[1]})),R=Object(j.a)(t,n,!!N,!!N,!0,g,h,"gatherArea/meeting/".concat(N,"/")),E=R.faceStream,D=R.faceStreamMap,w=Object(i.useState)(!1),G=Object(r.a)(w,2),T=G[0],B=G[1];return Object(c.jsxs)("div",{className:"GatherArea-container",children:[Object(c.jsxs)("div",{className:"GatherArea-body",onMouseMove:function(e){A.current&&A.current(e)},onMouseUp:function(){C()},children:[Object.entries(S).map((function(e){var a=Object(r.a)(e,2),i=a[0],o=a[1];return Object(c.jsx)(f,{roomId:t,userId:n,nickname:l,id:i,data:o,highlight:i===N},i)})),Object.entries(M).map((function(e){var t=Object(r.a)(e,2),a=t[0],i=t[1];if(a===n)return null;var o=y.find((function(e){return e.userId===a}));return o?Object(c.jsx)(m,{nickname:o.info.nickname,statusMesg:o.info.message,image:o.image,position:i.position,registerOnMouseDrag:C,stream:D[a]},a):null})),Object(c.jsx)(m,{nickname:l,statusMesg:p,image:x,position:k.position,setPosition:function(e){return z((function(t){return Object(a.a)(Object(a.a)({},t),{},{position:e})}))},registerOnMouseDrag:C,stream:E||void 0,muted:!0})]}),Object(c.jsx)("div",{className:"GatherArea-toolbar",children:Object(c.jsxs)("div",{children:[Object(c.jsx)("button",{type:"button",onClick:function(){return B((function(e){return!e}))},children:T?"Close Region Editor":"Open Region Editor"}),T&&Object(c.jsx)("div",{className:"GatherArea-region-editor",children:Object(c.jsx)(d,{roomId:t,userId:n})})]})})]})}));t.default=g}}]);
//# sourceMappingURL=20.b203a223.chunk.js.map