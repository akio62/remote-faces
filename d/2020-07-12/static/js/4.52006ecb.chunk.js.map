{"version":3,"sources":["hooks/useRoom.ts","hooks/useNicknameMap.ts","media/video.ts","media/devices.ts","hooks/useAvailableDevices.ts","utils/storage.ts","media/capture.ts","hooks/useFaceImages.ts","media/audio.ts","hooks/useFaceVideos.ts","components/FaceImages.tsx","hooks/useMomentaryChat.ts","utils/emoji.ts","components/WysiwygEditor.tsx","components/MomentaryChat.tsx","components/ControlPanel.tsx","components/SettingPanel.tsx","components/UserStatus.tsx","components/SelectivePane.tsx","components/SingleRoom.tsx"],"names":["roomEntryMap","Map","register","roomId","userId","listeners","roomEntryKey","entry","get","networkStatusListeners","Set","newPeerListeners","dataListeners","trackListeners","room","createRoom","status","forEach","listener","peerIndex","data","info","track","count","set","networkStatusListener","add","newPeerListener","dataListener","trackListener","mediaTypeSet","Array","from","map","x","mediaType","prevSize","size","acceptMediaTypes","definedEntry","broadcastData","sendData","addTrack","removeTrack","unregister","delete","dispose","useRoomNetworkStatus","onNetworkStatus","useState","networkStatus","updateNetworkStatus","type","Error","err","message","useEffect","ns","useRoomNewPeer","getInitialData","a","useBroadcastData","broadcastDataRef","useRef","useCallback","current","registered","useRoomData","onRoomData","useRoomMedia","onTrack","functions","setFunctions","result","cache","createMapFromCache","nickname","useNicknameMap","nicknameMap","setNicknameMap","isObject","index","findIndex","now","Date","lastUpdated","push","i","length","splice","prev","keys","Object","every","key","getVideoStream","deviceId","constraints","video","navigator","mediaDevices","getUserMedia","stream","getVideoTracks","stop","getFaceVideoStream","document","getElementById","style","display","srcObject","sleep","srcW","videoWidth","srcH","videoHeight","canvas","ctx","getContext","width","height","ratio","Math","max","min","y","loop","drawImage","timer","setTimeout","canvasStream","captureStream","clearTimeout","checkVideTrackFaceSize","createElement","MediaStream","videoTrackFaceSizeMap","WeakMap","isVideoTrackFaceSize","has","promise","getVideoDeviceInfoList","enumerateDevices","devices","list","filter","kind","label","getAudioDeviceInfoList","useVideoDevices","setDevices","deviceInfoList","useAudioDevices","setStringItem","name","value","window","localStorage","setItem","e","console","getStringItem","getItem","captureImage","ImageCapture","imageCapture","takePhoto","blob","createImageBitmap","srcImg","grabFrame","savedSrcObject","revert","dstW","dstH","toDataURL","isImageData","image","liveMode","isFaceInfo","getAudioStream","audio","getAudioTracks","applyConstraints","echoCancellation","echoCancellationType","ideal","noiseSuppression","addTrackToStream","disposeStream","newStream","dispatchEvent","MediaStreamTrackEvent","addEventListener","getTracks","FaceImage","React","memo","statusMesg","obsoleted","muted","micOn","speakerOn","className","opacity","ref","videoEle","autoPlay","playsInline","src","alt","title","FaceImages","videoDeviceId","audioDeviceId","myImage","setMyImage","roomImages","setRoomImages","fatalError","setFatalError","lastDataRef","roomImage","received","find","item","changed","next","checkObsoletedImage","twoMinAgo","tenMinAgo","didCleanup","useFaceImages","videoEnabled","audioEnabled","faceStream","setFaceStream","faceStreamMap","setFaceStreamMap","isMounted","s","oldStream","rest","undefined","addVideoTrack","removeVideoTrack","addAudioTrack","removeAudioTrack","videoStream","disposeVideo","videoTrack","Event","audioStream","disposeAudio","audioTrack","enabled","onaddtrack","event","removeEventListener","useFaceVideos","isReply","isArray","isChatItem","messageId","createdAt","text","isReplies","replies","time","compareReply","b","countDiff","useMomentaryChat","chatList","setChatList","chatListRef","addChatItem","chatData","chatInReplyTo","chatText","replyMap","entries","sort","chatItem","toLocaleString","split","slice","some","newList","pop","isChatList","sendChat","secureRandomId","replyChat","inReplyTo","EmojiPicker","Picker","config","toolbar","balloonToolbar","link","addTargetToExternalLinks","WysiwygEditor","registerClear","onChange","editor","CustomEditor","onInit","setData","plugins","addItems","character","initEditor","_event","getData","MomentaryChatContentPart","openEmojiPicker","setOpenEmojiPicker","reply","onSelect","native","onClick","dangerouslySetInnerHTML","__html","DOMPurify","sanitize","ADD_ATTR","MomentaryChatContent","latestMessageId","scrollTop","scrollHeight","MomentaryChat","containerRef","clearRef","setText","clear","disabled","ControlPanel","setLiveMode","setMicOn","setSpeakerOn","secondColumnOpen","setSecondColumnOpen","initialConfigOpen","appLink","location","href","replace","TextField","initialText","onUpdate","buttonLabel","placeholder","clearOnUpdate","onSubmit","preventDefault","target","SettingPanel","setNickname","setVideoDeviceId","setAudioDeviceId","configOpen","setConfigOpen","videoDevices","audioDevices","o","readOnly","videoDevice","audioDevice","JSON","stringify","UserStatus","emoji","setEmoji","setStatusMesg","components","Welcome","lazy","SelectivePane","activePane","setActivePane","initialNickname","initialVideoDeviceId","initialAudioDeviceId","SingleRoom","setRoomIdToUrl","thirdColumnOpen","setThirdColumnOpen"],"mappings":"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","file":"static/js/4.52006ecb.chunk.js","sourcesContent":["import { useEffect, useState, useCallback, useRef } from \"react\";\n\nimport { PeerInfo, createRoom, NetworkStatus } from \"../network/room\";\n\ntype NetworkStatusListener = (status: NetworkStatus) => void;\ntype NewPeerListener = (peerIndex: number) => void;\ntype DataListener = (data: unknown, info: PeerInfo) => void;\ntype TrackListener = {\n  mediaType: string;\n  listener: (track: MediaStreamTrack, info: PeerInfo) => void;\n};\ntype RoomEntry = {\n  room: ReturnType<typeof createRoom>;\n  networkStatusListeners: Set<NetworkStatusListener>;\n  newPeerListeners: Set<NewPeerListener>;\n  dataListeners: Set<DataListener>;\n  trackListeners: Set<TrackListener>;\n  count: number;\n};\nconst roomEntryMap = new Map<string, RoomEntry>();\nconst register = (\n  roomId: string,\n  userId: string,\n  listeners: {\n    networkStatusListener?: NetworkStatusListener;\n    newPeerListener?: NewPeerListener;\n    dataListener?: DataListener;\n    trackListener?: TrackListener;\n  }\n) => {\n  const roomEntryKey = `${roomId}_${userId}`;\n  let entry = roomEntryMap.get(roomEntryKey);\n  if (!entry) {\n    const networkStatusListeners = new Set<NetworkStatusListener>();\n    const newPeerListeners = new Set<NewPeerListener>();\n    const dataListeners = new Set<DataListener>();\n    const trackListeners = new Set<TrackListener>();\n    const updateNetworkStatus = (status: NetworkStatus) => {\n      networkStatusListeners.forEach((listener) => {\n        listener(status);\n      });\n    };\n    const notifyNewPeer = (peerIndex: number) => {\n      newPeerListeners.forEach((listener) => {\n        listener(peerIndex);\n      });\n    };\n    const receiveData = (data: unknown, info: PeerInfo) => {\n      dataListeners.forEach((listener) => {\n        listener(data, info);\n      });\n    };\n    const receiveTrack = (track: MediaStreamTrack, info: PeerInfo) => {\n      trackListeners.forEach(({ listener }) => {\n        listener(track, info);\n      });\n    };\n    const room = createRoom(\n      roomId,\n      userId,\n      updateNetworkStatus,\n      notifyNewPeer,\n      receiveData,\n      receiveTrack\n    );\n    entry = {\n      room,\n      networkStatusListeners,\n      newPeerListeners,\n      dataListeners,\n      trackListeners,\n      count: 0,\n    };\n    roomEntryMap.set(roomEntryKey, entry);\n  }\n  if (listeners.networkStatusListener) {\n    entry.networkStatusListeners.add(listeners.networkStatusListener);\n  }\n  if (listeners.newPeerListener) {\n    entry.newPeerListeners.add(listeners.newPeerListener);\n  }\n  if (listeners.dataListener) {\n    entry.dataListeners.add(listeners.dataListener);\n  }\n  if (listeners.trackListener) {\n    const mediaTypeSet = new Set(\n      Array.from(entry.trackListeners).map((x) => x.mediaType)\n    );\n    const prevSize = mediaTypeSet.size;\n    entry.trackListeners.add(listeners.trackListener);\n    mediaTypeSet.add(listeners.trackListener.mediaType);\n    if (prevSize !== mediaTypeSet.size) {\n      entry.room.acceptMediaTypes(Array.from(mediaTypeSet));\n    }\n  }\n  entry.count += 1;\n  const definedEntry = entry;\n  const unregister = () => {\n    if (listeners.networkStatusListener) {\n      definedEntry.networkStatusListeners.delete(\n        listeners.networkStatusListener\n      );\n    }\n    if (listeners.newPeerListener) {\n      definedEntry.newPeerListeners.delete(listeners.newPeerListener);\n    }\n    if (listeners.dataListener) {\n      definedEntry.dataListeners.delete(listeners.dataListener);\n    }\n    if (listeners.trackListener) {\n      let mediaTypeSet = new Set(\n        Array.from(definedEntry.trackListeners).map((x) => x.mediaType)\n      );\n      const prevSize = mediaTypeSet.size;\n      definedEntry.trackListeners.delete(listeners.trackListener);\n      mediaTypeSet = new Set(\n        Array.from(definedEntry.trackListeners).map((x) => x.mediaType)\n      );\n      if (prevSize !== mediaTypeSet.size) {\n        definedEntry.room.acceptMediaTypes(Array.from(mediaTypeSet));\n      }\n    }\n    definedEntry.count -= 1;\n    if (definedEntry.count <= 0) {\n      definedEntry.room.dispose();\n      roomEntryMap.delete(roomEntryKey);\n    }\n  };\n  return {\n    broadcastData: entry.room.broadcastData,\n    sendData: entry.room.sendData,\n    addTrack: entry.room.addTrack,\n    removeTrack: entry.room.removeTrack,\n    unregister,\n  };\n};\n\nexport const useRoomNetworkStatus = (\n  roomId: string,\n  userId: string,\n  onNetworkStatus?: (networkStatus: NetworkStatus) => void\n) => {\n  const [networkStatus, updateNetworkStatus] = useState<NetworkStatus>();\n  if (networkStatus && networkStatus.type === \"UNKNOWN_ERROR\") {\n    throw new Error(`Network Error: ${networkStatus.err.message}`);\n  }\n  useEffect(() => {\n    const { unregister } = register(roomId, userId, {\n      networkStatusListener: (ns: NetworkStatus) => {\n        updateNetworkStatus(ns);\n        if (onNetworkStatus) onNetworkStatus(ns);\n      },\n    });\n    return unregister;\n  }, [roomId, userId, onNetworkStatus]);\n  return networkStatus;\n};\n\nexport const useRoomNewPeer = (\n  roomId: string,\n  userId: string,\n  getInitialData: () => Promise<unknown | null>\n) => {\n  useEffect(() => {\n    const { unregister, sendData } = register(roomId, userId, {\n      newPeerListener: async (peerIndex) => {\n        const data = await getInitialData();\n        if (data !== null) {\n          sendData(data, peerIndex);\n        }\n      },\n    });\n    return unregister;\n  }, [roomId, userId, getInitialData]);\n};\n\ntype BroadcastData = ReturnType<typeof createRoom>[\"broadcastData\"];\n\nexport const useBroadcastData = (roomId: string, userId: string) => {\n  const broadcastDataRef = useRef<BroadcastData>();\n  const broadcastData = useCallback((...args: Parameters<BroadcastData>) => {\n    if (broadcastDataRef.current) {\n      broadcastDataRef.current(...args);\n    } else {\n      // TODO pending queue\n    }\n  }, []);\n  useEffect(() => {\n    const registered = register(roomId, userId, {});\n    broadcastDataRef.current = registered.broadcastData;\n    return registered.unregister;\n  }, [roomId, userId]);\n  return broadcastData;\n};\n\nexport const useRoomData = (\n  roomId: string,\n  userId: string,\n  onRoomData: (data: unknown, info: PeerInfo) => void\n) => {\n  useEffect(() => {\n    const { unregister } = register(roomId, userId, {\n      dataListener: onRoomData,\n    });\n    return unregister;\n  }, [roomId, userId, onRoomData]);\n};\n\nexport const useRoomMedia = (\n  roomId: string,\n  userId: string,\n  onTrack: (track: MediaStreamTrack, info: PeerInfo) => void,\n  mediaType?: string\n) => {\n  const [functions, setFunctions] = useState<{\n    addTrack?: (track: MediaStreamTrack) => void;\n    removeTrack?: (track: MediaStreamTrack) => void;\n  }>({});\n  useEffect(() => {\n    if (mediaType) {\n      const result = register(roomId, userId, {\n        trackListener: { mediaType, listener: onTrack },\n      });\n      setFunctions({\n        addTrack: (track: MediaStreamTrack) =>\n          result.addTrack(mediaType, track),\n        removeTrack: (track: MediaStreamTrack) =>\n          result.removeTrack(mediaType, track),\n      });\n      return () => {\n        setFunctions({});\n        result.unregister();\n      };\n    }\n    return undefined;\n  }, [roomId, userId, onTrack, mediaType]);\n  return functions;\n};\n","import { useCallback, useState } from \"react\";\n\nimport { isObject } from \"../utils/types\";\nimport { useRoomData } from \"./useRoom\";\n\ntype Entry = {\n  roomId: string;\n  userId: string;\n  nickname: string;\n  lastUpdated: number;\n};\nconst cache: Entry[] = [];\nconst TTL = 10 * 60 * 1000; // 10min\n\nconst createMapFromCache = (roomId: string) => {\n  const map: { [userId: string]: string } = {};\n  cache.forEach((entry) => {\n    if (entry.roomId === roomId) {\n      map[entry.userId] = entry.nickname;\n    }\n  });\n  return map;\n};\n\nconst hasInfoNickname = (x: unknown): x is { info: { nickname: string } } =>\n  isObject(x) &&\n  isObject((x as { info: unknown }).info) &&\n  typeof (x as { info: { nickname: unknown } }).info.nickname === \"string\";\n\nexport const useNicknameMap = (roomId: string, userId: string) => {\n  const [nicknameMap, setNicknameMap] = useState<{\n    [userId: string]: string;\n  }>(() => createMapFromCache(roomId));\n  useRoomData(\n    roomId,\n    userId,\n    useCallback(\n      (data, info) => {\n        if (!hasInfoNickname(data)) return;\n        const index = cache.findIndex(\n          (entry) => entry.roomId === roomId && entry.userId === info.userId\n        );\n        const now = Date.now();\n        if (index >= 0) {\n          if (cache[index].nickname !== data.info.nickname) {\n            cache[index].nickname = data.info.nickname;\n          }\n          cache[index].lastUpdated = now;\n        } else {\n          cache.push({\n            roomId,\n            userId: info.userId,\n            nickname: data.info.nickname,\n            lastUpdated: now,\n          });\n        }\n        for (let i = cache.length - 1; i >= 0; i -= 1) {\n          if (cache[i].lastUpdated + TTL < now) {\n            cache.splice(i, 1);\n          }\n        }\n        setNicknameMap((prev) => {\n          const map = createMapFromCache(roomId);\n          const keys = Object.keys(map);\n          if (\n            keys.length === Object.keys(prev).length &&\n            keys.every((key) => map[key] === prev[key])\n          ) {\n            return prev;\n          }\n          return map;\n        });\n      },\n      [roomId]\n    )\n  );\n  return nicknameMap;\n};\n","import { sleep } from \"../utils/sleep\";\n\nexport const getVideoStream = async (deviceId?: string) => {\n  const constraints = deviceId\n    ? {\n        video: { deviceId },\n      }\n    : { video: true };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getVideoTracks();\n  const dispose = () => {\n    track.stop();\n  };\n  return {\n    stream,\n    dispose,\n  };\n};\n\nexport const getFaceVideoStream = async (deviceId?: string) => {\n  const constraints = deviceId\n    ? {\n        video: { deviceId },\n      }\n    : { video: true };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getVideoTracks();\n  const video = document.getElementById(\"internal-video\") as HTMLVideoElement;\n  video.style.display = \"block\";\n  video.srcObject = stream;\n  await sleep(1000);\n  const srcW = video.videoWidth;\n  const srcH = video.videoHeight;\n  const canvas = document.getElementById(\n    \"internal-canvas\"\n  ) as HTMLCanvasElement;\n  const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  const dstW = 72;\n  const dstH = 72;\n  canvas.width = dstW;\n  canvas.height = dstH;\n  const ratio = Math.max(dstW / srcW, dstH / srcH);\n  const width = Math.min(srcW, dstW / ratio);\n  const height = Math.min(srcH, dstH / ratio);\n  const x = (srcW - width) / 2;\n  const y = (srcH - height) / 2;\n  let timer: NodeJS.Timeout;\n  const loop = () => {\n    ctx.drawImage(video, x, y, width, height, 0, 0, dstW, dstH);\n    timer = setTimeout(loop, 1000 / 15);\n  };\n  loop();\n  const canvasStream = (canvas as any).captureStream() as MediaStream;\n  const dispose = () => {\n    video.style.display = \"none\";\n    clearTimeout(timer);\n    track.stop();\n    canvasStream.getVideoTracks()[0].stop();\n  };\n  return {\n    stream: canvasStream,\n    dispose,\n  };\n};\n\nconst checkVideTrackFaceSize = async (track: MediaStreamTrack) => {\n  try {\n    const video = document.createElement(\"video\");\n    video.srcObject = new MediaStream([track]);\n    for (let i = 0; i < 50; i += 1) {\n      // eslint-disable-next-line no-await-in-loop\n      await sleep(100);\n      const width = video.videoWidth;\n      const height = video.videoHeight;\n      if (width > 0 && height > 0) {\n        return width === 72 && height === 72;\n      }\n    }\n    return true; // fallback to true\n  } catch (e) {\n    return true; // fallback to true\n  }\n};\n\nconst videoTrackFaceSizeMap = new WeakMap<MediaStreamTrack, Promise<boolean>>();\n\nexport const isVideoTrackFaceSize = (track: MediaStreamTrack) => {\n  if (videoTrackFaceSizeMap.has(track)) {\n    return videoTrackFaceSizeMap.get(track) as Promise<boolean>;\n  }\n  const promise = checkVideTrackFaceSize(track);\n  videoTrackFaceSizeMap.set(track, promise);\n  return promise;\n};\n","type DeviceInfo = {\n  label: string;\n  deviceId: string;\n};\n\nexport const getVideoDeviceInfoList = async () => {\n  try {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const list: DeviceInfo[] = devices\n      .filter(({ kind }) => kind === \"videoinput\")\n      .map(({ label, deviceId }) => ({ label, deviceId }));\n    return list;\n  } catch (e) {\n    // ignored\n    return [];\n  }\n};\n\nexport const getAudioDeviceInfoList = async () => {\n  try {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const list: DeviceInfo[] = devices\n      .filter(({ kind }) => kind === \"audioinput\")\n      .map(({ label, deviceId }) => ({ label, deviceId }));\n    return list;\n  } catch (e) {\n    // ignored\n    return [];\n  }\n};\n","import { useEffect, useState } from \"react\";\n\nimport {\n  getVideoDeviceInfoList,\n  getAudioDeviceInfoList,\n} from \"../media/devices\";\n\ntype VideoDeviceInfoList = ReturnType<\n  typeof getVideoDeviceInfoList\n> extends Promise<infer T>\n  ? T\n  : never;\n\nexport const useVideoDevices = () => {\n  const [devices, setDevices] = useState<VideoDeviceInfoList>([]);\n  useEffect(() => {\n    (async () => {\n      const deviceInfoList = await getVideoDeviceInfoList();\n      setDevices(deviceInfoList);\n    })();\n  }, []);\n  return devices;\n};\n\ntype AudioDeviceInfoList = ReturnType<\n  typeof getAudioDeviceInfoList\n> extends Promise<infer T>\n  ? T\n  : never;\n\nexport const useAudioDevices = () => {\n  const [devices, setDevices] = useState<AudioDeviceInfoList>([]);\n  useEffect(() => {\n    (async () => {\n      const deviceInfoList = await getAudioDeviceInfoList();\n      setDevices(deviceInfoList);\n    })();\n  }, []);\n  return devices;\n};\n","type StringItemName =\n  | \"nickname\"\n  | \"config_hidden\"\n  | \"faceimage_video_device_id\"\n  | \"faceimage_audio_device_id\";\n\ntype JsonItemName = \"TODO2\" | \"TODO3\";\n\nexport const setStringItem = (name: StringItemName, value: string) => {\n  try {\n    window.localStorage.setItem(name, value);\n  } catch (e) {\n    console.info(\"Failed to save string to localStorage\", e);\n  }\n};\n\nexport const getStringItem = (name: StringItemName) => {\n  try {\n    return window.localStorage.getItem(name) || \"\";\n  } catch (e) {\n    // ignore\n    return \"\";\n  }\n};\n\nexport const setJsonItem = (name: JsonItemName, value: unknown) => {\n  try {\n    window.localStorage.setItem(name, JSON.stringify(value));\n  } catch (e) {\n    console.info(\"Failed to save json to localStorage\", e);\n  }\n};\n\nexport const getJsonItem = (name: JsonItemName): unknown | null => {\n  try {\n    return JSON.parse(window.localStorage.getItem(name) || \"\");\n  } catch (e) {\n    // ignore\n    return null;\n  }\n};\n\nexport const removeItem = (name: StringItemName | JsonItemName) => {\n  try {\n    window.localStorage.removeItem(name);\n  } catch (e) {\n    // ignore\n  }\n};\n","import { sleep } from \"../utils/sleep\";\n\nconst captureImage = async (stream: MediaStream, track: MediaStreamTrack) => {\n  if (typeof ImageCapture !== \"undefined\") {\n    const imageCapture = new ImageCapture(track);\n    await sleep(2000);\n    let srcImg;\n    try {\n      const blob = await imageCapture.takePhoto();\n      srcImg = await createImageBitmap(blob);\n    } catch (e) {\n      srcImg = await imageCapture.grabFrame();\n    }\n    const srcW = srcImg.width;\n    const srcH = srcImg.height;\n    return { srcImg, srcW, srcH };\n  }\n  const video = document.getElementById(\"internal-video\") as HTMLVideoElement;\n  video.style.display = \"block\";\n  const savedSrcObject = video.srcObject;\n  const revert = () => {\n    video.srcObject = savedSrcObject;\n  };\n  video.srcObject = stream;\n  await sleep(2000);\n  const srcImg = video;\n  const srcW = video.videoWidth;\n  const srcH = video.videoHeight;\n  return { srcImg, srcW, srcH, revert };\n};\n\nexport const takePhoto = async (deviceId?: string) => {\n  const constraints = deviceId\n    ? {\n        video: { deviceId },\n      }\n    : { video: true };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getVideoTracks();\n  const canvas = document.getElementById(\n    \"internal-canvas\"\n  ) as HTMLCanvasElement;\n  const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  const dstW = 72;\n  const dstH = 72;\n  canvas.width = dstW;\n  canvas.height = dstH;\n  const { srcImg, srcW, srcH, revert } = await captureImage(stream, track);\n  const ratio = Math.max(dstW / srcW, dstH / srcH);\n  const width = Math.min(srcW, dstW / ratio);\n  const height = Math.min(srcH, dstH / ratio);\n  const x = (srcW - width) / 2;\n  const y = (srcH - height) / 2;\n  ctx.drawImage(srcImg, x, y, width, height, 0, 0, dstW, dstH);\n  if (revert) {\n    revert();\n  }\n  track.stop();\n  return canvas.toDataURL(\"image/jpeg\");\n};\n","import { useCallback, useEffect, useState, useRef } from \"react\";\n\nimport { isObject } from \"../utils/types\";\nimport { takePhoto } from \"../media/capture\";\nimport {\n  useRoomData,\n  useBroadcastData,\n  useRoomNetworkStatus,\n  useRoomNewPeer,\n} from \"./useRoom\";\n\ntype ImageUrl = string;\ntype FaceInfo = {\n  nickname: string;\n  message: string;\n  liveMode: boolean;\n  micOn: boolean;\n  speakerOn: boolean;\n};\ntype ImageData = {\n  image: ImageUrl;\n  info: FaceInfo;\n};\ntype RoomImage = ImageData & {\n  userId: string;\n  received: number; // in milliseconds\n  obsoleted: boolean;\n  peerIndex: number;\n};\n\nconst isFaceInfo = (x: unknown): x is FaceInfo =>\n  isObject(x) &&\n  typeof (x as { nickname: unknown }).nickname === \"string\" &&\n  typeof (x as { message: unknown }).message === \"string\" &&\n  typeof (x as { liveMode: unknown }).liveMode === \"boolean\";\n\nconst isImageData = (x: unknown): x is ImageData =>\n  isObject(x) &&\n  typeof (x as { image: unknown }).image === \"string\" &&\n  isFaceInfo((x as { info: unknown }).info);\n\nexport const useFaceImages = (\n  roomId: string,\n  userId: string,\n  nickname: string,\n  statusMesg: string,\n  liveMode: boolean,\n  micOn: boolean,\n  speakerOn: boolean,\n  deviceId?: string\n) => {\n  const [myImage, setMyImage] = useState<ImageUrl>();\n  const [roomImages, setRoomImages] = useState<RoomImage[]>([]);\n\n  const [fatalError, setFatalError] = useState<Error>();\n  if (fatalError) {\n    throw fatalError;\n  }\n\n  const lastDataRef = useRef<ImageData>();\n  useRoomNewPeer(\n    roomId,\n    userId,\n    useCallback(async () => {\n      if (!lastDataRef.current) return null;\n      return lastDataRef.current;\n    }, [])\n  );\n\n  const broadcastData = useBroadcastData(roomId, userId);\n  useRoomData(\n    roomId,\n    userId,\n    useCallback((data, info) => {\n      if (!isImageData(data)) return;\n      const roomImage = {\n        ...data,\n        userId: info.userId,\n        received: Date.now(),\n        obsoleted: false,\n        peerIndex: info.peerIndex,\n      };\n      setRoomImages((prev) => {\n        const found = prev.find((item) => item.userId === roomImage.userId);\n        if (!found) {\n          return [...prev, roomImage];\n        }\n        return prev.map((item) =>\n          item.userId === roomImage.userId ? roomImage : item\n        );\n      });\n    }, [])\n  );\n\n  useRoomNetworkStatus(\n    roomId,\n    userId,\n    useCallback((networkStatus) => {\n      if (networkStatus && networkStatus.type === \"CONNECTION_CLOSED\") {\n        const { peerIndex } = networkStatus;\n        setRoomImages((prev) => {\n          let changed = false;\n          const next = prev.map((item) => {\n            if (item.peerIndex === peerIndex) {\n              changed = true;\n              return { ...item, obsoleted: true };\n            }\n            return item;\n          });\n          return changed ? next : prev;\n        });\n      }\n    }, [])\n  );\n\n  useEffect(() => {\n    const checkObsoletedImage = () => {\n      const twoMinAgo = Date.now() - 2 * 60 * 1000;\n      const tenMinAgo = Date.now() - 10 * 60 * 1000;\n      setRoomImages((prev) => {\n        let changed = false;\n        const next = prev\n          .map((item) => {\n            if (item.received < twoMinAgo && !item.obsoleted) {\n              changed = true;\n              return { ...item, obsoleted: true };\n            }\n            if (item.received < tenMinAgo && item.obsoleted) {\n              changed = true;\n              return null;\n            }\n            return item;\n          })\n          .filter((item) => item) as typeof prev;\n\n        return changed ? next : prev;\n      });\n    };\n    let didCleanup = false;\n    let timer: NodeJS.Timeout;\n    const loop = async () => {\n      if (didCleanup) return;\n      try {\n        checkObsoletedImage();\n        const image = await takePhoto(deviceId);\n        if (didCleanup) return;\n        setMyImage(image);\n        const info: FaceInfo = {\n          nickname,\n          message: statusMesg,\n          liveMode,\n          micOn,\n          speakerOn,\n        };\n        const data: ImageData = {\n          image,\n          info,\n        };\n        broadcastData(data);\n        lastDataRef.current = data;\n      } catch (e) {\n        setFatalError(e);\n      }\n      timer = setTimeout(loop, 2 * 60 * 1000);\n    };\n    loop();\n    return () => {\n      didCleanup = true;\n      clearTimeout(timer);\n    };\n  }, [\n    roomId,\n    userId,\n    deviceId,\n    nickname,\n    statusMesg,\n    liveMode,\n    micOn,\n    speakerOn,\n    broadcastData,\n  ]);\n\n  return {\n    myImage,\n    roomImages,\n  };\n};\n","export const getAudioStream = async (deviceId?: string) => {\n  const constraints = deviceId\n    ? {\n        audio: { deviceId },\n      }\n    : { audio: true };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getAudioTracks();\n  await track.applyConstraints({\n    echoCancellation: true,\n    echoCancellationType: { ideal: \"system\" },\n    noiseSuppression: { ideal: true },\n  } as MediaTrackConstraints);\n  const dispose = () => {\n    track.stop();\n  };\n  return {\n    stream,\n    dispose,\n  };\n};\n","import { useCallback, useEffect, useState, useRef } from \"react\";\n\nimport { getFaceVideoStream, isVideoTrackFaceSize } from \"../media/video\";\nimport { getAudioStream } from \"../media/audio\";\nimport { useRoomMedia } from \"./useRoom\";\n\nconst addTrackToStream = (\n  track: MediaStreamTrack,\n  stream: MediaStream | null,\n  disposeStream: (s: MediaStream) => void\n) => {\n  const newStream = stream || new MediaStream();\n  newStream.addTrack(track);\n  newStream.dispatchEvent(new MediaStreamTrackEvent(\"addtrack\", { track }));\n  track.addEventListener(\"ended\", () => {\n    newStream.removeTrack(track);\n    if (newStream.getTracks().length === 0) {\n      disposeStream(newStream);\n    }\n  });\n  return newStream;\n};\n\nexport const useFaceVideos = (\n  roomId: string,\n  userId: string,\n  videoEnabled: boolean,\n  audioEnabled: boolean,\n  micOn: boolean,\n  videoDeviceId?: string,\n  audioDeviceId?: string\n) => {\n  const [faceStream, setFaceStream] = useState<MediaStream | null>(null);\n  const [faceStreamMap, setFaceStreamMap] = useState<{\n    [userId: string]: MediaStream;\n  }>({});\n\n  const isMounted = useRef(true);\n  useEffect(() => {\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  const onTrack = useCallback(async (track, info) => {\n    if (track.kind === \"video\" && !(await isVideoTrackFaceSize(track))) {\n      return;\n    }\n    const disposeStream = (s: MediaStream) => {\n      if (isMounted.current) {\n        setFaceStreamMap((prev) => {\n          const { [info.userId]: oldStream, ...rest } = prev;\n          if (oldStream === s) {\n            return rest;\n          }\n          return prev;\n        });\n      }\n    };\n    setFaceStreamMap((prev) => {\n      const stream = prev[info.userId];\n      const newStream = addTrackToStream(track, stream, disposeStream);\n      if (stream === newStream) {\n        return prev;\n      }\n      return { ...prev, [info.userId]: newStream };\n    });\n  }, []);\n\n  const {\n    addTrack: addVideoTrack,\n    removeTrack: removeVideoTrack,\n  } = useRoomMedia(\n    roomId,\n    userId,\n    onTrack,\n    videoEnabled ? \"faceVideo\" : undefined\n  );\n\n  const {\n    addTrack: addAudioTrack,\n    removeTrack: removeAudioTrack,\n  } = useRoomMedia(\n    roomId,\n    userId,\n    onTrack,\n    audioEnabled ? \"faceAudio\" : undefined\n  );\n\n  useEffect(() => {\n    let dispose: (() => void) | null = null;\n    if (videoEnabled && addVideoTrack && removeVideoTrack) {\n      (async () => {\n        const {\n          stream: videoStream,\n          dispose: disposeVideo,\n        } = await getFaceVideoStream(videoDeviceId);\n        const [videoTrack] = videoStream.getVideoTracks();\n        addVideoTrack(videoTrack);\n        const disposeStream = (s: MediaStream) => {\n          if (isMounted.current) {\n            setFaceStream((prev) => (prev === s ? null : prev));\n          }\n        };\n        setFaceStream((prev) =>\n          addTrackToStream(videoTrack, prev, disposeStream)\n        );\n        dispose = () => {\n          removeVideoTrack(videoTrack);\n          disposeVideo();\n          // XXX we need to manually dispatch ended event, why?\n          videoTrack.dispatchEvent(new Event(\"ended\"));\n        };\n      })();\n    }\n    return () => {\n      if (dispose) dispose();\n    };\n  }, [roomId, videoEnabled, videoDeviceId, addVideoTrack, removeVideoTrack]);\n\n  useEffect(() => {\n    let dispose: (() => void) | null = null;\n    if (audioEnabled && addAudioTrack && removeAudioTrack) {\n      (async () => {\n        const {\n          stream: audioStream,\n          dispose: disposeAudio,\n        } = await getAudioStream(audioDeviceId);\n        const [audioTrack] = audioStream.getAudioTracks();\n        addAudioTrack(audioTrack);\n        const disposeStream = (s: MediaStream) => {\n          if (isMounted.current) {\n            setFaceStream((prev) => (prev === s ? null : prev));\n          }\n        };\n        setFaceStream((prev) =>\n          addTrackToStream(audioTrack, prev, disposeStream)\n        );\n        dispose = () => {\n          removeAudioTrack(audioTrack);\n          disposeAudio();\n          // XXX we need to manually dispatch ended event, why?\n          audioTrack.dispatchEvent(new Event(\"ended\"));\n        };\n      })();\n    }\n    return () => {\n      if (dispose) dispose();\n    };\n  }, [roomId, audioEnabled, audioDeviceId, addAudioTrack, removeAudioTrack]);\n  useEffect(() => {\n    if (faceStream) {\n      faceStream.getAudioTracks().forEach((track) => {\n        const audioTrack = track;\n        audioTrack.enabled = micOn;\n      });\n      const onaddtrack = (event: MediaStreamTrackEvent) => {\n        const { track } = event;\n        if (track.kind === \"audio\") {\n          track.enabled = micOn;\n        }\n      };\n      faceStream.addEventListener(\"addtrack\", onaddtrack);\n      return () => {\n        faceStream.removeEventListener(\"addtrack\", onaddtrack);\n      };\n    }\n    return undefined;\n  }, [faceStream, micOn]);\n\n  return { faceStream, faceStreamMap };\n};\n","import React from \"react\";\n\nimport \"./FaceImages.css\";\nimport { useFaceImages } from \"../hooks/useFaceImages\";\nimport { useFaceVideos } from \"../hooks/useFaceVideos\";\n\nconst BLANK_IMAGE =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12NgYAAAAAMAASDVlMcAAAAASUVORK5CYII=\";\n\nconst FaceImage = React.memo<{\n  image?: string;\n  nickname: string;\n  statusMesg: string;\n  obsoleted?: boolean;\n  liveMode: boolean;\n  stream?: MediaStream;\n  muted: boolean;\n  micOn?: boolean;\n  speakerOn?: boolean;\n}>(\n  ({\n    image,\n    nickname,\n    statusMesg,\n    obsoleted,\n    liveMode,\n    stream,\n    muted,\n    micOn,\n    speakerOn,\n  }) => (\n    <div className=\"FaceImages-card\" style={{ opacity: obsoleted ? 0.2 : 1 }}>\n      {liveMode && !obsoleted && stream ? (\n        <video\n          className=\"FaceImages-photo\"\n          ref={(videoEle) => {\n            if (videoEle && videoEle.srcObject !== stream) {\n              // eslint-disable-next-line no-param-reassign\n              videoEle.srcObject = stream;\n            }\n          }}\n          autoPlay\n          playsInline\n          muted={muted}\n        />\n      ) : (\n        <img\n          src={image || BLANK_IMAGE}\n          className=\"FaceImages-photo\"\n          alt=\"myself\"\n        />\n      )}\n      <div className=\"FaceImages-name\">{nickname}</div>\n      <div\n        className=\"FaceImages-mesg\"\n        title={[...statusMesg][1] ? statusMesg : \"(No status message)\"}\n      >\n        {[...statusMesg][0]}\n      </div>\n      {liveMode && !obsoleted && stream && (\n        <div className=\"FaceImages-live-indicator\" title=\"Live Mode On\">\n          &#9673;\n        </div>\n      )}\n      {liveMode && !obsoleted && !stream && (\n        <div className=\"FaceImages-live-indicator\" title=\"Live Mode Available\">\n          &#9678;\n        </div>\n      )}\n      {liveMode && !obsoleted && (\n        <div className=\"FaceImages-mic-speaker-icons\">\n          {micOn && <span title=\"Mic On\">&#x1F3A4;</span>}\n          {speakerOn && <span title=\"Speaker On\">&#x1F508;</span>}\n        </div>\n      )}\n    </div>\n  )\n);\n\nexport const FaceImages = React.memo<{\n  roomId: string;\n  userId: string;\n  nickname: string;\n  statusMesg: string;\n  liveMode: boolean;\n  micOn: boolean;\n  speakerOn: boolean;\n  videoDeviceId?: string;\n  audioDeviceId?: string;\n}>(\n  ({\n    roomId,\n    userId,\n    nickname,\n    statusMesg,\n    liveMode,\n    micOn,\n    speakerOn,\n    videoDeviceId,\n    audioDeviceId,\n  }) => {\n    const { myImage, roomImages } = useFaceImages(\n      roomId,\n      userId,\n      nickname,\n      statusMesg,\n      liveMode,\n      micOn,\n      speakerOn,\n      videoDeviceId\n    );\n    const { faceStream, faceStreamMap } = useFaceVideos(\n      roomId,\n      userId,\n      liveMode,\n      liveMode,\n      micOn,\n      videoDeviceId,\n      audioDeviceId\n    );\n\n    return (\n      <>\n        <FaceImage\n          image={myImage}\n          nickname={nickname}\n          statusMesg={statusMesg}\n          liveMode={liveMode}\n          stream={faceStream || undefined}\n          muted\n        />\n        {roomImages.map((item) => (\n          <FaceImage\n            key={item.userId}\n            image={item.image}\n            nickname={item.info.nickname}\n            statusMesg={item.info.message}\n            obsoleted={item.obsoleted}\n            liveMode={item.info.liveMode}\n            stream={(liveMode && faceStreamMap[item.userId]) || undefined}\n            muted={!speakerOn}\n            micOn={item.info.micOn}\n            speakerOn={item.info.speakerOn}\n          />\n        ))}\n      </>\n    );\n  }\n);\n","import { useState, useCallback, useRef, useEffect } from \"react\";\n\nimport { secureRandomId } from \"../utils/crypto\";\nimport { isObject } from \"../utils/types\";\nimport { useRoomData, useBroadcastData, useRoomNewPeer } from \"./useRoom\";\n\nconst MAX_CHAT_LIST_SIZE = 100;\n\ntype ChatData = {\n  userId: string;\n  nickname: string;\n  messageId: string;\n  createdAt: number; // in millisecond\n  chatText: string;\n  chatInReplyTo?: string; // messageId\n};\n\nconst isChatData = (x: unknown): x is ChatData =>\n  isObject(x) &&\n  typeof (x as { userId: unknown }).userId === \"string\" &&\n  typeof (x as { nickname: unknown }).nickname === \"string\" &&\n  typeof (x as { messageId: unknown }).messageId === \"string\" &&\n  typeof (x as { createdAt: unknown }).createdAt === \"number\" &&\n  typeof (x as { chatText: unknown }).chatText === \"string\" &&\n  (typeof (x as { chatInReplyTo: unknown }).chatInReplyTo === \"undefined\" ||\n    typeof (x as { chatInReplyTo: unknown }).chatInReplyTo === \"string\");\n\ntype Reply = [string, number];\n\nconst isReply = (x: unknown): x is Reply =>\n  Array.isArray(x) &&\n  x.length === 2 &&\n  typeof x[0] === \"string\" &&\n  typeof x[1] === \"number\";\n\nconst isReplies = (x: unknown): x is Reply[] =>\n  Array.isArray(x) && x.every(isReply);\n\nexport type ChatItem = {\n  messageId: string;\n  nickname: string;\n  createdAt: number; // in millisecond\n  text: string;\n  replies: Reply[];\n  time: string;\n};\n\nconst isChatItem = (x: unknown): x is ChatItem =>\n  isObject(x) &&\n  typeof (x as { messageId: unknown }).messageId === \"string\" &&\n  typeof (x as { nickname: unknown }).nickname === \"string\" &&\n  typeof (x as { createdAt: unknown }).createdAt === \"number\" &&\n  typeof (x as { text: unknown }).text === \"string\" &&\n  isReplies((x as { replies: unknown }).replies) &&\n  typeof (x as { time: unknown }).time === \"string\";\n\ntype ChatList = ChatItem[];\n\nconst isChatList = (x: unknown): x is ChatList =>\n  Array.isArray(x) && x.every(isChatItem);\n\nconst compareReply = (a: Reply, b: Reply) => {\n  const countDiff = b[1] - a[1];\n  if (countDiff === 0) {\n    return a[0].length - b[0].length;\n  }\n  return countDiff;\n};\n\nexport const useMomentaryChat = (\n  roomId: string,\n  userId: string,\n  nickname: string\n) => {\n  const [chatList, setChatList] = useState<ChatList>([]);\n  const chatListRef = useRef(chatList);\n  useEffect(() => {\n    chatListRef.current = chatList;\n  });\n\n  const addChatItem = useCallback((chatData: ChatData) => {\n    if (chatData.chatInReplyTo) {\n      const { chatText, chatInReplyTo } = chatData;\n      setChatList((prev) =>\n        prev.map((item) => {\n          if (item.messageId === chatInReplyTo) {\n            const replyMap = new Map(item.replies);\n            replyMap.set(chatText, (replyMap.get(chatText) || 0) + 1);\n            const replies = [...replyMap.entries()];\n            replies.sort(compareReply);\n            return { ...item, replies };\n          }\n          return item;\n        })\n      );\n      return;\n    }\n    const chatItem: ChatItem = {\n      messageId: chatData.messageId,\n      nickname: chatData.nickname,\n      createdAt: chatData.createdAt,\n      text: chatData.chatText,\n      replies: [],\n      time: new Date(chatData.createdAt)\n        .toLocaleString()\n        .split(\" \")[1]\n        .slice(0, -3),\n    };\n    setChatList((prev) => {\n      if (prev.some((item) => item.messageId === chatItem.messageId)) {\n        // Migration: This can happen if a peer with old version is connected.\n        return prev;\n      }\n      const newList = [chatItem, ...prev];\n      if (newList.length > MAX_CHAT_LIST_SIZE) {\n        newList.pop();\n      }\n      newList.sort((a, b) => b.createdAt - a.createdAt); // slow?\n      return newList;\n    });\n  }, []);\n\n  useRoomNewPeer(\n    roomId,\n    userId,\n    useCallback(async () => {\n      // TODO do not let all peers send initial data\n      return chatListRef.current;\n    }, [])\n  );\n\n  const broadcastData = useBroadcastData(roomId, userId);\n  useRoomData(\n    roomId,\n    userId,\n    useCallback(\n      (data) => {\n        if (isChatData(data)) {\n          addChatItem(data);\n        } else if (isChatList(data)) {\n          setChatList((prev) => {\n            if (prev.length === 0) {\n              // we only replace with the list if it's empty\n              return data;\n            }\n            return prev;\n          });\n        }\n      },\n      [addChatItem]\n    )\n  );\n\n  const sendChat = useCallback(\n    (text: string) => {\n      const data: ChatData = {\n        userId,\n        nickname,\n        messageId: secureRandomId(),\n        createdAt: Date.now(),\n        chatText: text,\n      };\n      broadcastData(data);\n      addChatItem(data);\n    },\n    [broadcastData, userId, nickname, addChatItem]\n  );\n\n  const replyChat = useCallback(\n    (text: string, inReplyTo: string) => {\n      const data: ChatData = {\n        userId,\n        nickname,\n        messageId: secureRandomId(),\n        createdAt: Date.now(),\n        chatText: text,\n        chatInReplyTo: inReplyTo,\n      };\n      broadcastData(data);\n      addChatItem(data);\n    },\n    [broadcastData, userId, nickname, addChatItem]\n  );\n\n  return {\n    chatList,\n    sendChat,\n    replyChat,\n  };\n};\n","import React from \"react\";\nimport \"emoji-mart/css/emoji-mart.css\";\nimport { BaseEmoji, Picker } from \"emoji-mart\";\n\nexport { Emoji } from \"emoji-mart\";\nexport type EmojiDataType = BaseEmoji;\n\n// we do not support custom emojis\nexport const EmojiPicker = Picker as React.ComponentType<\n  | Omit<React.ComponentProps<typeof Picker>, \"custom\" | \"onSelect\">\n  | {\n      onSelect: (emoji: BaseEmoji) => void;\n    }\n>;\n","// @ts-nocheck XXX ckeditor5 doesn't come with types\n\nimport React from \"react\";\nimport CKEditor from \"@ckeditor/ckeditor5-react\";\nimport CustomEditor from \"@daishi/ckeditor5-build-inline-custom\";\n\nimport \"./WysiwygEditor.css\";\n\nconst config = {\n  toolbar: [\n    \"specialCharacters\",\n    \"|\",\n    \"bold\",\n    \"italic\",\n    \"link\",\n    \"blockQuote\",\n    \"|\",\n    \"imageUpload\",\n    \"insertTable\",\n    \"mediaEmbed\",\n    \"|\",\n    \"undo\",\n    \"redo\",\n  ],\n  balloonToolbar: [\n    \"heading\",\n    \"|\",\n    \"bulletedList\",\n    \"numberedList\",\n    \"indent\",\n    \"outdent\",\n  ],\n  link: {\n    addTargetToExternalLinks: true,\n  },\n};\n\nconst initEditor = (editor) => {\n  editor.plugins.get(\"SpecialCharacters\").addItems(\"Emoji\", [\n    { title: \"smiley face\", character: \"😊\" },\n    { title: \"rocket\", character: \"🚀\" },\n    { title: \"wind blowing face\", character: \"🌬️\" },\n    { title: \"floppy disk\", character: \"💾\" },\n    { title: \"heart\", character: \"❤️\" },\n  ]);\n};\n\nexport const WysiwygEditor = React.memo<{\n  registerClear: (clear: () => void) => void;\n  onChange: (data: string) => void;\n}>(({ registerClear, onChange }) => (\n  <CKEditor\n    editor={CustomEditor}\n    config={config}\n    onInit={(editor) => {\n      registerClear(() => {\n        editor.setData(\"\");\n      });\n      initEditor(editor);\n    }}\n    onChange={(_event, editor) => {\n      const data = editor.getData();\n      onChange(data);\n    }}\n  />\n));\n","import React, { useState, useRef, useEffect } from \"react\";\nimport DOMPurify from \"dompurify\";\n\nimport \"./MomentaryChat.css\";\nimport { useMomentaryChat, ChatItem } from \"../hooks/useMomentaryChat\";\nimport { EmojiPicker } from \"../utils/emoji\";\nimport { WysiwygEditor } from \"./WysiwygEditor\";\n\ntype ChatList = ReturnType<typeof useMomentaryChat>[\"chatList\"];\ntype ReplyChat = ReturnType<typeof useMomentaryChat>[\"replyChat\"];\n\nconst sanitize = (text: string) => ({\n  __html: DOMPurify.sanitize(text, { ADD_ATTR: [\"target\"] }),\n});\n\nconst MomentaryChatContentPart = React.memo<{\n  item: ChatItem;\n  replyChat: ReplyChat;\n}>(({ item, replyChat }) => {\n  const [openEmojiPicker, setOpenEmojiPicker] = useState(false);\n  const reply = (text: string) => replyChat(text, item.messageId);\n  return (\n    <li key={item.messageId} className=\"MomentaryChat-listPart\">\n      {openEmojiPicker && (\n        <EmojiPicker\n          onSelect={(e) => {\n            reply(e.native);\n            setOpenEmojiPicker(false);\n          }}\n          style={{ width: \"100%\" }}\n        />\n      )}\n      <div className=\"MomentaryChat-listPart-header\">\n        <div className=\"MomentaryChat-iconButton-container\">\n          <div className=\"MomentaryChat-iconButton\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                setOpenEmojiPicker(!openEmojiPicker);\n              }}\n            >\n              +\n            </button>\n          </div>\n        </div>\n        <span className=\"MomentaryChat-nickname\">\n          {item.nickname || \"No Name\"}\n        </span>\n        <span className=\"MomentaryChat-time\">{item.time}</span>\n      </div>\n      <div\n        className=\"MomentaryChat-text ck-content\"\n        dangerouslySetInnerHTML={sanitize(item.text)}\n      />\n      {item.replies.map(([text, count]) => (\n        <button\n          key={text}\n          className=\"MomentaryChat-icon\"\n          type=\"button\"\n          onClick={() => reply(text)}\n        >\n          {text} {count}\n        </button>\n      ))}\n    </li>\n  );\n});\n\nconst MomentaryChatContent = React.memo<{\n  chatList: ChatList;\n  replyChat: ReplyChat;\n}>(({ chatList, replyChat }) => {\n  const chatListRef = useRef<HTMLUListElement | null>(null);\n  const latestMessageId = chatList[0]?.messageId;\n  useEffect(() => {\n    if (chatListRef.current && latestMessageId) {\n      chatListRef.current.scrollTop = chatListRef.current.scrollHeight;\n    }\n  }, [latestMessageId]);\n\n  return (\n    <ul className=\"MomentaryChat-list\" ref={chatListRef}>\n      {chatList.map((item) => (\n        <MomentaryChatContentPart\n          key={item.messageId}\n          item={item}\n          replyChat={replyChat}\n        />\n      ))}\n    </ul>\n  );\n});\n\nexport const MomentaryChat = React.memo<{\n  roomId: string;\n  userId: string;\n  nickname: string;\n}>(({ roomId, userId, nickname }) => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const { chatList, sendChat, replyChat } = useMomentaryChat(\n    roomId,\n    userId,\n    nickname\n  );\n\n  const clearRef = useRef<() => void>();\n  const registerClear = (clear: () => void) => {\n    clearRef.current = clear;\n  };\n\n  const [text, setText] = useState(\"\");\n  const onClick = () => {\n    if (text) {\n      sendChat(text);\n      setText(\"\");\n      if (clearRef.current) {\n        clearRef.current();\n      }\n    }\n  };\n\n  return (\n    <div className=\"MomentaryChat-container\" ref={containerRef}>\n      <MomentaryChatContent chatList={chatList} replyChat={replyChat} />\n      <div className=\"MomentaryChat-editor\">\n        <WysiwygEditor registerClear={registerClear} onChange={setText} />\n      </div>\n      <div className=\"MomentaryChat-button\">\n        <button type=\"button\" onClick={onClick} disabled={!text}>\n          Send\n        </button>\n      </div>\n    </div>\n  );\n});\n","import React, { Dispatch, SetStateAction } from \"react\";\n\nimport \"./ControlPanel.css\";\n\nexport const ControlPanel = React.memo<{\n  liveMode: boolean;\n  setLiveMode: Dispatch<SetStateAction<boolean>>;\n  micOn: boolean;\n  setMicOn: Dispatch<SetStateAction<boolean>>;\n  speakerOn: boolean;\n  setSpeakerOn: Dispatch<SetStateAction<boolean>>;\n  secondColumnOpen: boolean;\n  setSecondColumnOpen: Dispatch<SetStateAction<boolean>>;\n}>(\n  ({\n    liveMode,\n    setLiveMode,\n    micOn,\n    setMicOn,\n    speakerOn,\n    setSpeakerOn,\n    secondColumnOpen,\n    setSecondColumnOpen,\n  }) => (\n    <div className=\"ControlPanel-container\">\n      <button\n        type=\"button\"\n        onClick={() => setLiveMode((x) => !x)}\n        title={liveMode ? \"Disable Live Mode\" : \"Enable Live Mode\"}\n      >\n        &#x1F3A5;\n        {!liveMode && <span className=\"ControlPanel-disabled\">&#10060;</span>}\n      </button>\n      <button\n        type=\"button\"\n        onClick={() => setSecondColumnOpen((x) => !x)}\n        title={secondColumnOpen ? \"Close Right Pane\" : \"Open Right Pane\"}\n      >\n        {secondColumnOpen ? <>&#9664;</> : <>&#9654;</>}\n      </button>\n      <button\n        type=\"button\"\n        onClick={() => setMicOn((x) => !x)}\n        title={micOn ? \"Disable Mic\" : \"Enable Mic\"}\n      >\n        &#x1F3A4;\n        {!micOn && <span className=\"ControlPanel-disabled\">&#10060;</span>}\n      </button>\n      <button\n        type=\"button\"\n        onClick={() => setSpeakerOn((x) => !x)}\n        title={speakerOn ? \"Disable Speaker\" : \"Enable Speaker\"}\n      >\n        <>&#x1F508;</>\n        {!speakerOn && <span className=\"ControlPanel-disabled\">&#10060;</span>}\n      </button>\n    </div>\n  )\n);\n","import React, { Dispatch, SetStateAction, useEffect, useState } from \"react\";\n\nimport \"./SettingPanel.css\";\nimport { setStringItem, getStringItem } from \"../utils/storage\";\nimport { useRoomNetworkStatus } from \"../hooks/useRoom\";\nimport { useVideoDevices, useAudioDevices } from \"../hooks/useAvailableDevices\";\n\nconst initialConfigOpen = getStringItem(\"config_hidden\") !== \"true\";\n\nconst appLink = `remote-faces://${window.location.href.replace(\n  /^https:\\/\\//,\n  \"\"\n)}`;\n\nconst TextField = React.memo<{\n  initialText: string;\n  onUpdate: (text: string) => void;\n  buttonLabel?: string;\n  placeholder?: string;\n  clearOnUpdate?: boolean;\n}>(({ initialText, onUpdate, buttonLabel, placeholder, clearOnUpdate }) => {\n  const [text, setText] = useState(initialText);\n  const onSubmit = (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (text) {\n      onUpdate(text);\n      if (clearOnUpdate) {\n        setText(\"\");\n      }\n    }\n  };\n\n  return (\n    <form onSubmit={onSubmit}>\n      <input\n        value={text}\n        onChange={(e) => setText(e.target.value)}\n        placeholder={placeholder}\n      />\n      {buttonLabel && (\n        <button type=\"submit\" disabled={!text}>\n          {buttonLabel}\n        </button>\n      )}\n    </form>\n  );\n});\n\nexport const SettingPanel = React.memo<{\n  roomId: string;\n  userId: string;\n  nickname: string;\n  setNickname: Dispatch<SetStateAction<string>>;\n  videoDeviceId: string;\n  setVideoDeviceId: Dispatch<SetStateAction<string>>;\n  audioDeviceId: string;\n  setAudioDeviceId: Dispatch<SetStateAction<string>>;\n}>(\n  ({\n    roomId,\n    userId,\n    nickname,\n    setNickname,\n    videoDeviceId,\n    setVideoDeviceId,\n    audioDeviceId,\n    setAudioDeviceId,\n  }) => {\n    const [configOpen, setConfigOpen] = useState(initialConfigOpen);\n    useEffect(() => {\n      setStringItem(\"config_hidden\", configOpen ? \"false\" : \"true\");\n    }, [configOpen]);\n\n    const videoDevices = useVideoDevices();\n    const audioDevices = useAudioDevices();\n    const networkStatus = useRoomNetworkStatus(roomId, userId);\n\n    return (\n      <div className=\"SettingPanel-container\">\n        <button\n          type=\"button\"\n          className=\"SettingPanel-config-toggle\"\n          onClick={() => setConfigOpen((o) => !o)}\n        >\n          Setting{configOpen ? <>&#9660;</> : <>&#9654;</>}\n        </button>\n        {configOpen && (\n          <div className=\"SettingPanel-config\">\n            <div className=\"SettingPanel-config-row\">\n              <span title=\"Share this link with your colleagues\">\n                Room Link:{\" \"}\n              </span>\n              <input value={window.location.href} readOnly />{\" \"}\n              <a href={appLink} title=\"Open this link in the desktop app\">\n                Open App\n              </a>\n            </div>\n            <div className=\"SettingPanel-config-row\">\n              Your Name:{\" \"}\n              <TextField\n                initialText={nickname}\n                onUpdate={(text) => {\n                  setNickname(text);\n                  setStringItem(\"nickname\", text);\n                }}\n                placeholder=\"Enter your name\"\n                buttonLabel=\"Set\"\n              />\n            </div>\n            <div className=\"SettingPanel-config-row\">\n              Select Camera:{\" \"}\n              <select\n                value={videoDeviceId}\n                onChange={(e) => {\n                  setVideoDeviceId(e.target.value);\n                  setStringItem(\"faceimage_video_device_id\", e.target.value);\n                }}\n              >\n                {videoDevices.map((videoDevice) => (\n                  <option\n                    key={videoDevice.deviceId}\n                    value={videoDevice.deviceId}\n                  >\n                    {videoDevice.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"SettingPanel-config-row\">\n              Select Mic:{\" \"}\n              <select\n                value={audioDeviceId}\n                onChange={(e) => {\n                  setAudioDeviceId(e.target.value);\n                  setStringItem(\"faceimage_audio_device_id\", e.target.value);\n                }}\n              >\n                {audioDevices.map((audioDevice) => (\n                  <option\n                    key={audioDevice.deviceId}\n                    value={audioDevice.deviceId}\n                  >\n                    {audioDevice.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"SettingPanel-status\">\n              {JSON.stringify(networkStatus)}\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n","import React, { Dispatch, SetStateAction, useState } from \"react\";\n\nimport \"./UserStatus.css\";\nimport { Emoji, EmojiPicker, EmojiDataType } from \"../utils/emoji\";\n\nconst TextField = React.memo<{\n  initialText: string;\n  onUpdate: (text: string) => void;\n  buttonLabel?: string;\n  placeholder?: string;\n  clearOnUpdate?: boolean;\n}>(({ initialText, onUpdate, buttonLabel, placeholder, clearOnUpdate }) => {\n  const [text, setText] = useState(initialText);\n  const onSubmit = (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (text) {\n      onUpdate(text);\n      if (clearOnUpdate) {\n        setText(\"\");\n      }\n    }\n  };\n\n  return (\n    <form onSubmit={onSubmit}>\n      <input\n        value={text}\n        onChange={(e) => setText(e.target.value)}\n        placeholder={placeholder}\n      />\n      {buttonLabel && (\n        <button type=\"submit\" disabled={!text}>\n          {buttonLabel}\n        </button>\n      )}\n    </form>\n  );\n});\n\nexport const UserStatus = React.memo<{\n  emoji: EmojiDataType | null;\n  setEmoji: Dispatch<SetStateAction<EmojiDataType | null>>;\n  setStatusMesg: Dispatch<SetStateAction<string>>;\n}>(({ emoji, setEmoji, setStatusMesg }) => {\n  const [openEmojiPicker, setOpenEmojiPicker] = useState(false);\n  return (\n    <div className=\"UserStatus-container\">\n      <div className=\"UserStatus-status-area\">\n        <div className=\"UserStatus-emoji\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              setOpenEmojiPicker(!openEmojiPicker);\n            }}\n          >\n            {emoji ? <Emoji emoji={emoji} size={10} /> : \":)\"}\n          </button>\n        </div>\n        {emoji && (\n          <div className=\"UserStatus-statusmesg\">\n            <TextField\n              initialText=\"\"\n              onUpdate={setStatusMesg}\n              placeholder=\"Enter status message...\"\n              buttonLabel=\"Set\"\n            />\n          </div>\n        )}\n        <button\n          type=\"button\"\n          onClick={() => {\n            setEmoji(null);\n            setStatusMesg(\"\");\n            setOpenEmojiPicker(false);\n          }}\n          disabled={!emoji}\n        >\n          Clear\n        </button>\n      </div>\n      {openEmojiPicker && (\n        <EmojiPicker\n          onSelect={(e) => {\n            setEmoji(e);\n            setOpenEmojiPicker(false);\n          }}\n          style={{ width: \"100%\" }}\n        />\n      )}\n    </div>\n  );\n});\n","import React, { createElement, useState } from \"react\";\n\nimport \"./SelectivePane.css\";\n\ntype Name =\n  | \"Welcome\"\n  | \"Screen Share\"\n  | \"Video Share\"\n  | \"White Board\"\n  | \"Go Board\";\n\nconst components = {\n  Welcome: React.lazy(() => import(\"./Welcome\")),\n  \"Screen Share\": React.lazy(() => import(\"./ScreenShare\")),\n  \"Video Share\": React.lazy(() => import(\"./VideoShare\")),\n  \"White Board\": React.lazy(() => import(\"./CollabWhiteBoard\")),\n  \"Go Board\": React.lazy(() => import(\"./GoBoard\")),\n};\n\nexport const SelectivePane = React.memo<{\n  roomId: string;\n  userId: string;\n  nickname: string;\n}>(({ roomId, userId, nickname }) => {\n  const [activePane, setActivePane] = useState<Name>(\"Welcome\");\n  return (\n    <div className=\"SelectivePane-container\">\n      <div className=\"SelectivePane-select\">\n        &#9776;\n        <select\n          value={activePane}\n          onChange={(e) => setActivePane(e.target.value as Name)}\n        >\n          {Object.keys(components).map((name) => (\n            <option key={name} value={name}>\n              {name}\n            </option>\n          ))}\n        </select>\n      </div>\n      {createElement(components[activePane], {\n        roomId,\n        userId,\n        nickname,\n      })}\n    </div>\n  );\n});\n","import React, { useEffect, useState } from \"react\";\n\nimport \"./SingleRoom.css\";\nimport { setRoomIdToUrl } from \"../utils/url\";\nimport { getStringItem } from \"../utils/storage\";\nimport { useNicknameMap } from \"../hooks/useNicknameMap\";\nimport { FaceImages } from \"./FaceImages\";\nimport { MomentaryChat } from \"./MomentaryChat\";\nimport { ControlPanel } from \"./ControlPanel\";\nimport { SettingPanel } from \"./SettingPanel\";\nimport { UserStatus } from \"./UserStatus\";\nimport { SelectivePane } from \"./SelectivePane\";\nimport { EmojiDataType } from \"../utils/emoji\";\n\nconst initialNickname = getStringItem(\"nickname\");\nconst initialVideoDeviceId = getStringItem(\"faceimage_video_device_id\");\nconst initialAudioDeviceId = getStringItem(\"faceimage_audio_device_id\");\n\nexport const SingleRoom = React.memo<{\n  roomId: string;\n  userId: string;\n}>(({ roomId, userId }) => {\n  const [nickname, setNickname] = useState(initialNickname);\n  const [statusMesg, setStatusMesg] = useState(\"\");\n  const [emoji, setEmoji] = useState<EmojiDataType | null>(null);\n  useEffect(() => {\n    setRoomIdToUrl(roomId);\n  }, [roomId]);\n\n  const [videoDeviceId, setVideoDeviceId] = useState(initialVideoDeviceId);\n  const [audioDeviceId, setAudioDeviceId] = useState(initialAudioDeviceId);\n  const [liveMode, setLiveMode] = useState(false);\n  const [micOn, setMicOn] = useState(false);\n  const [speakerOn, setSpeakerOn] = useState(false);\n  const [secondColumnOpen, setSecondColumnOpen] = useState(true);\n  const [thirdColumnOpen, setThirdColumnOpen] = useState(true);\n\n  useNicknameMap(roomId, userId); // to enable caching\n\n  return (\n    <div className=\"SingleRoom-container\">\n      <div className=\"SingleRoom-1st-column\">\n        <ControlPanel\n          liveMode={liveMode}\n          setLiveMode={setLiveMode}\n          micOn={micOn}\n          setMicOn={setMicOn}\n          speakerOn={speakerOn}\n          setSpeakerOn={setSpeakerOn}\n          secondColumnOpen={secondColumnOpen}\n          setSecondColumnOpen={setSecondColumnOpen}\n        />\n        <FaceImages\n          roomId={roomId}\n          userId={userId}\n          videoDeviceId={videoDeviceId}\n          audioDeviceId={audioDeviceId}\n          nickname={nickname}\n          statusMesg={`${emoji?.native || \" \"}${statusMesg}`}\n          liveMode={liveMode}\n          micOn={micOn}\n          speakerOn={speakerOn}\n        />\n      </div>\n      <div\n        className=\"SingleRoom-2nd-column\"\n        style={{ width: secondColumnOpen ? \"inherit\" : \"0\" }}\n      >\n        <button\n          type=\"button\"\n          className=\"SingleRoom-toggle-3rd-column\"\n          onClick={() => setThirdColumnOpen((x) => !x)}\n          title={thirdColumnOpen ? \"Close Right Pane\" : \"Open Right Pane\"}\n        >\n          {thirdColumnOpen ? <>&#9664;</> : <>&#9654;</>}\n        </button>\n        <UserStatus\n          emoji={emoji}\n          setEmoji={setEmoji}\n          setStatusMesg={setStatusMesg}\n        />\n        <SettingPanel\n          roomId={roomId}\n          userId={userId}\n          nickname={nickname}\n          setNickname={setNickname}\n          videoDeviceId={videoDeviceId}\n          setVideoDeviceId={setVideoDeviceId}\n          audioDeviceId={audioDeviceId}\n          setAudioDeviceId={setAudioDeviceId}\n        />\n        <MomentaryChat roomId={roomId} userId={userId} nickname={nickname} />\n      </div>\n      <div\n        className=\"SingleRoom-3rd-column\"\n        style={{ display: thirdColumnOpen ? \"inherit\" : \"none\" }}\n      >\n        <SelectivePane roomId={roomId} userId={userId} nickname={nickname} />\n      </div>\n    </div>\n  );\n});\n\nexport default SingleRoom;\n"],"sourceRoot":""}