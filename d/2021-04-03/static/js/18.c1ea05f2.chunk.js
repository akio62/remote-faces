(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[18],{1272:function(e,t,n){},1287:function(e,t,n){"use strict";n.r(t),n.d(t,"MediaShare",(function(){return h}));var r=n(2),c=n.n(r),a=n(3),u=n(4),i=n(0),s=n(1),o=n.n(s),l=(n(1272),n(16)),b=n(95),d=n(17),f=n(332),j=n(237),O=n(105),v=n(20),p=n(151),m=o.a.memo((function(e){var t=e.nickname,n=e.stream,r=Object(s.useRef)(null);return Object(s.useEffect)((function(){n&&r.current&&(r.current.srcObject=n)}),[n]),Object(i.jsxs)("div",{className:"MediaShare-card",children:[Object(i.jsx)("video",{className:"MediaShare-video",ref:r,autoPlay:!0,muted:!0}),Object(i.jsx)("div",{className:"MediaShare-nickname",children:t})]})})),h=o.a.memo((function(e){var t=e.roomId,n=e.userId,r=e.nickname,o=e.uniqueId,h=Object(v.b)(),x=Object(s.useState)(""),k=Object(u.a)(x,2),S=k[0],y=k[1],g=Object(s.useState)(null),E=Object(u.a)(g,2),M=E[0],w=E[1],C=Object(s.useCallback)((function(){w(null)}),[]),N=function(e,t,n,r,i){var o="".concat(i||"mediaShare","Video"),v=Object(s.useState)(null),p=Object(u.a)(v,2),m=p[0],h=p[1],x=Object(s.useState)({}),k=Object(u.a)(x,2),S=k[0],y=k[1],g=Object(s.useRef)([]);Object(s.useEffect)((function(){return function(){g.current.forEach((function(e){return e()}))}}),[]);var E=Object(d.useSnapshot)(Object(O.a)(e,t).trackMap);return Object.entries(E[o]||{}).forEach((function(e){var t,n=Object(u.a)(e,2),r=n[0],c=n[1];if("ended"!==c.readyState&&!(null===(t=S[r])||void 0===t?void 0:t.getTracks().includes(c))){y((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(l.a)({},r,new MediaStream([c])))}));var a=function(){y((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(l.a)({},r,null))}))};c.addEventListener("ended",a),g.current.push((function(){c.removeEventListener("ended",a)}))}})),Object(s.useEffect)((function(){var n=Object(O.a)(e,t);return n.addMediaType(o),function(){n.removeMediaType(o)}}),[e,t,o]),Object(s.useEffect)((function(){var i=Object(O.a)(e,t),s=null;return n&&Object(a.a)(c.a.mark((function e(){var t,a,l,b,d,O;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("SCREEN"!==n){e.next=10;break}return e.next=3,Object(f.a)();case 3:if(a=e.sent){e.next=7;break}return r(),e.abrupt("return");case 7:t=a,e.next=13;break;case 10:return e.next=12,Object(j.b)(n.video);case 12:t=e.sent;case 13:l=t.stream.getVideoTracks(),b=Object(u.a)(l,1),d=b[0],i.addTrack(o,d),h(t.stream),d.addEventListener("ended",(function(){s&&s(),s=null})),O=function(){i.removeTrack(o),t.dispose(),h(null),r()},!1===s?O():s=O;case 19:case"end":return e.stop()}}),e)})))(),function(){s&&s(),s=!1}}),[e,t,o,n,r]),{videoStream:m,videoStreamMap:S}}(t,n,M,C,o),T=N.videoStream,R=N.videoStreamMap,I=Object(p.a)(t,n),F=Object(s.useState)("grid"),V=Object(u.a)(F,2),D=V[0],q=V[1],L=(T?1:0)+Object.values(R).filter((function(e){return e})).length,J=Math.ceil(Math.sqrt(L)),A=Math.ceil(L/J),G="grid"===D?{gridTemplateColumns:"repeat(".concat(J,", 1fr)"),gridTemplateRows:"repeat(".concat(A,", ").concat(100/A,"%)")}:{gridTemplateRows:Array(L).fill("100%").join(" ")},P=Object(s.useRef)(null),z=Object(s.useState)(!1),B=Object(u.a)(z,2),H=B[0],K=B[1],Q=function(){var e=Object(a.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!P.current){e.next=10;break}return e.prev=1,e.next=4,P.current.requestFullscreen();case 4:K(!0),P.current.onfullscreenchange=function(){K(document.fullscreenElement===P.current)},e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(a.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{document.exitFullscreen(),K(!1)}catch(t){}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsxs)("div",{className:"MediaShare-container",ref:P,children:[Object(i.jsxs)("div",{className:"MediaShare-toolbar",children:[!H&&Object(i.jsx)("button",{type:"button",onClick:Q,children:"Enter Fullscreen"}),H&&Object(i.jsx)("button",{type:"button",onClick:U,children:"Exit Fullscreen"}),Object(i.jsxs)("select",{value:D,onChange:function(e){return q(e.target.value)},children:[Object(i.jsx)("option",{value:"grid",children:"Display in Grid"}),Object(i.jsx)("option",{value:"vertical",children:"Display Vertically"})]}),null!==M&&Object(i.jsx)("button",{type:"button",onClick:C,children:"Stop sharing"}),null===M&&Object(i.jsx)("button",{type:"button",onClick:function(){return w("SCREEN")},children:"Start Screen Share"}),null===M&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("select",{value:S,onChange:function(e){return y(e.target.value)},children:[Object(i.jsx)("option",{value:"",disabled:!0,children:"Select Camera to Share"}),h.map((function(e){return Object(i.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)}))]}),S&&Object(i.jsx)("button",{type:"button",onClick:function(){return w({video:S})},children:"Start Video Share"})]})]}),Object(i.jsxs)("div",{className:"MediaShare-body",style:G,children:[T&&Object(i.jsx)(m,{nickname:r,stream:T}),Object.keys(R).map((function(e){var t=R[e];return t?Object(i.jsx)(m,{nickname:I[e]||"No Name",stream:t},e):null}))]})]})}));t.default=h},151:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(95),c=n(4),a=n(1),u=n(108),i=n(105),s=function(e,t){var n=Object(a.useState)({}),s=Object(c.a)(n,2),o=s[0],l=s[1];return Object(a.useEffect)((function(){var n=Object(i.a)(e,t).ydoc.getMap("faceImages"),c=function(){l((function(e){var c=Object(r.a)({},e),a=!1;return n.forEach((function(e,n){var r;n!==t&&(r=e,Object(u.c)(r)&&Object(u.c)(r.info)&&"string"===typeof r.info.nickname&&(c[n]?e.info.nickname!==c[n]&&(c[n]=e.info.nickname,a=!0):(c[n]=e.info.nickname,a=!0)))})),a?c:e}))};return n.observe(c),c(),function(){n.unobserve(c)}}),[e,t]),o}},332:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2),c=n.n(r),a=n(4),u=n(3),i=function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r,u,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={video:!0},e.next=4,navigator.mediaDevices.getDisplayMedia(t);case 4:return n=e.sent,r=n.getVideoTracks(),u=Object(a.a)(r,1),i=u[0],s=function(){i.stop()},e.abrupt("return",{stream:n,dispose:s});case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=18.c1ea05f2.chunk.js.map